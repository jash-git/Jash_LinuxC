<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0060)http://www.cnblogs.com/aga-j/archive/2011/09/18/2180658.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script async="" type="text/javascript" src="./09_files/gpt.js"></script>

<title>Linux TCP server系列（7）-select模式下的prefork server - Aga.J - 博客园</title>
<link type="text/css" rel="stylesheet" href="./09_files/common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./09_files/style.css">
<link type="text/css" rel="stylesheet" href="./09_files/common2.css">
<link type="text/css" rel="stylesheet" href="./09_files/shStyle.css">
<link type="text/css" rel="stylesheet" href="./09_files/customcss.aspx">
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/aga-j/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/aga-j/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/aga-j/wlwmanifest.xml">
<script type="text/javascript" async="" src="./09_files/ga.js"></script><script type="text/javascript" src="./09_files/encoder.js"></script><script type="text/javascript" async="" src="./09_files/map.js"></script><script src="./09_files/jquery.js" type="text/javascript"></script><style type="text/css"></style>  
<script type="text/javascript">
var currentBlogApp = 'aga-j';
</script>
<script src="./09_files/common.js" type="text/javascript"></script> 
<script src="./09_files/json2.js" type="text/javascript"></script>
<script src="./09_files/skin.js" language="javascript" type="text/javascript"></script>
<script type="text/javascript" src="./09_files/syntaxHighlighter.js"></script>
<style id="wrc-middle-css" type="text/css">.wrc_whole_window{	display: none;	position: fixed; 	z-index: 2147483647;	background-color: rgba(40, 40, 40, 0.9);	word-spacing: normal !important;	margin: 0px !important;	padding: 0px !important;	border: 0px !important;	left: 0px;	top: 0px;	width: 100%;	height: 100%;	line-height: normal !important;	letter-spacing: normal !important;	overflow: hidden;}.wrc_bar_window{	display: none;	position: fixed; 	z-index: 2147483647;	background-color: rgba(60, 60, 60, 1.0);	word-spacing: normal !important;	font-family: Segoe UI, Arial Unicode MS, Arial, Sans-Serif;	margin: 0px !important;	padding: 0px !important;	border: 0px !important;	left: 0px;	top: 0px;	width: 100%;	height: 40px;	line-height: normal !important;	letter-spacing: normal !important;	color: white !important;	font-size: 13px !important;}.wrc_middle {	display: table-cell;	vertical-align: middle;	width: 100%;}.wrc_middle_main {	font-family: Segoe UI, Arial Unicode MS, Arial, Sans-Serif;	font-size: 14px;	width: 600px;	height: auto;    background: url(chrome-extension://icmlaeflemplmjndnaapfdbbnpncnbda/skin/images/background-body.jpg) repeat-x left top;	background-color: rgb(39, 53, 62);	position: relative;	margin-left: auto;	margin-right: auto;	text-align: left;}.wrc_middle_tq_main {	font-family: Segoe UI, Arial Unicode MS, Arial, Sans-Serif;	font-size: 16px;	width: 615px;	height: 460px;    background: url(chrome-extension://icmlaeflemplmjndnaapfdbbnpncnbda/skin/images/background-sitecorrect.png) no-repeat;	background-color: white;	color: black !important;	position: relative;	margin-left: auto;	margin-right: auto;	text-align: center;}.wrc_middle_logo {    background: url(chrome-extension://icmlaeflemplmjndnaapfdbbnpncnbda/skin/images/logo.jpg) no-repeat left bottom;    width: 140px;    height: 42px;    color: orange;    display: table-cell;    text-align: right;    vertical-align: middle;}.wrc_icon_warning {	margin: 20px 10px 20px 15px;	float: left;	background-color: transparent;}.wrc_middle_title {    color: #b6bec7;	height: auto;    margin: 0px auto;	font-size: 2.2em;	white-space: nowrap;	text-align: center;}.wrc_middle_hline {    height: 2px;	width: 100%;    display: block;}.wrc_middle_description {	text-align: center;	margin: 15px;	font-size: 1.4em;	padding: 20px;	height: auto;	color: white;	min-height: 3.5em;}.wrc_middle_actions_main_div {	margin-bottom: 15px;	text-align: center;}.wrc_middle_actions_blue_button div {	display: inline-block;	width: auto;	cursor: Pointer;	margin: 3px 10px 3px 10px;	color: white;	font-size: 1.2em;	font-weight: bold;}.wrc_middle_actions_blue_button {	-moz-appearance: none;	border-radius: 7px;	-moz-border-radius: 7px/7px;	border-radius: 7px/7px;	background-color: rgb(0, 173, 223) !important;	display: inline-block;	width: auto;	cursor: Pointer;	border: 2px solid #00dddd;	padding: 0px 20px 0px 20px;}.wrc_middle_actions_blue_button:hover {	background-color: rgb(0, 159, 212) !important;}.wrc_middle_actions_blue_button:active {	background-color: rgb(0, 146, 200) !important;	border: 2px solid #00aaaa;}.wrc_middle_actions_grey_button div {	display: inline-block;	width: auto;	cursor: Pointer;	margin: 3px 10px 3px 10px;	color: white !important;	font-size: 15px;	font-weight: bold;}.wrc_middle_actions_grey_button {	-moz-appearance: none;	border-radius: 7px;	-moz-border-radius: 7px/7px;	border-radius: 7px/7px;	background-color: rgb(100, 100, 100) !important;	display: inline-block;	width: auto;	cursor: Pointer;	border: 2px solid #aaaaaa;	text-decoration: none;	padding: 0px 20px 0px 20px;}.wrc_middle_actions_grey_button:hover {	background-color: rgb(120, 120, 120) !important;}.wrc_middle_actions_grey_button:active {	background-color: rgb(130, 130, 130) !important;	border: 2px solid #00aaaa;}.wrc_middle_action_low {	font-size: 0.9em;	white-space: nowrap;	cursor: Pointer;	color: grey !important;	margin: 10px 10px 0px 10px;	text-decoration: none;}.wrc_middle_action_low:hover {	color: #aa4400 !important;}.wrc_middle_actions_rest_div {	padding-top: 5px;	white-space: nowrap;	text-align: center;}.wrc_middle_action {	white-space: nowrap;	cursor: Pointer;	color: red !important;	font-size: 1.2em;	margin: 10px 10px 0px 10px;	text-decoration: none;}.wrc_middle_action:hover {	color: #aa4400 !important;}</style><script id="wrc-script-middle_window" type="text/javascript" language="JavaScript">var g_inputsCnt = 0;var g_InputThis = new Array(null, null, null, null);var g_alerted = false;/* we test the input if it includes 4 digits   (input is a part of 4 inputs for filling the credit-card number)*/function is4DigitsCardNumber(val){	var regExp = new RegExp('[0-9]{4}');	return (val.length == 4 && val.search(regExp) == 0);}/* testing the whole credit-card number 19 digits devided by three '-' symbols or   exactly 16 digits without any dividers*/function isCreditCardNumber(val){	if(val.length == 19)	{		var regExp = new RegExp('[0-9]{4}-[0-9]{4}-[0-9]{4}-[0-9]{4}');		return (val.search(regExp) == 0);	}	else if(val.length == 16)	{		var regExp = new RegExp('[0-9]{4}[0-9]{4}[0-9]{4}[0-9]{4}');		return (val.search(regExp) == 0);	}	return false;}function CheckInputOnCreditNumber(self){	if(g_alerted)		return false;	var value = self.value;	if(self.type == 'text')	{		if(is4DigitsCardNumber(value))		{			var cont = true;			for(i = 0; i < g_inputsCnt; i++)				if(g_InputThis[i] == self)					cont = false;			if(cont && g_inputsCnt < 4)			{				g_InputThis[g_inputsCnt] = self;				g_inputsCnt++;			}		}		g_alerted = (g_inputsCnt == 4);		if(g_alerted)			g_inputsCnt = 0;		else			g_alerted = isCreditCardNumber(value);	}	return g_alerted;}function CheckInputOnPassword(self){	if(g_alerted)		return false;	var value = self.value;	if(self.type == 'password')	{		g_alerted = (value.length > 0);	}	return g_alerted;}function onInputBlur(self, bRatingOk, bFishingSite){	var bCreditNumber = CheckInputOnCreditNumber(self);	var bPassword = CheckInputOnPassword(self);	if((!bRatingOk || bFishingSite == 1) && (bCreditNumber || bPassword) )	{		var warnDiv = document.getElementById("wrcinputdiv");		if(warnDiv)		{			/* show the warning div in the middle of the screen */			warnDiv.style.left = "0px";			warnDiv.style.top = "0px";			warnDiv.style.width = "100%";			warnDiv.style.height = "100%";			document.getElementById("wrc_warn_fs").style.display = 'none';			document.getElementById("wrc_warn_cn").style.display = 'none';			if(bFishingSite)				document.getElementById("wrc_warn_fs").style.display = 'block';			else				document.getElementById("wrc_warn_cn").style.display = 'block';			warnDiv.style.display = 'table';		}	}}</script><script async="" type="text/javascript" src="http://common.cnblogs.com/script/google_ads_gpt.js"></script></head><style type="text/css">embed[type*="application/x-shockwave-flash"],embed[src*=".swf"],object[type*="application/x-shockwave-flash"],object[codetype*="application/x-shockwave-flash"],object[src*=".swf"],object[codebase*="swflash.cab"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"],object[classid*="d27cdb6e-ae6d-11cf-96b8-444553540000"],object[classid*="D27CDB6E-AE6D-11cf-96B8-444553540000"]{	display: none !important;}</style>
<body><script src="http://tajs.qq.com/jiathis.php?uid=1626433&dm=www.cnblogs.com" charset="utf-8"></script><link href="./09_files/jiathis_share.css" rel="stylesheet" type="text/css"><div class="jiathis_style" style="height: auto; position: absolute; z-index: 100000000; top: 154.5px; right: 0px; overflow: hidden; width: 26px;"><table cellpadding="0" cellspacing="0"><tbody style="background:transparent"><tr><td style="background:transparent"><img src="./09_files/r.gif" style="cursor:pointer;" onmouseover="$CKE.over()" onclick="$CKE.center(this)"></td><td><div><div class="jiadiv_01"><div style="width:100%;background:#F2F2F2;border-bottom:1px solid #E5E5E5;line-height:200%;padding-left:5px;font-size:12px"><table width="100%"><tbody><tr class="jt_sharetitle"><td align="left" style="text-align:left;line-height:25px;font-size:14px;font-weight:bold;color:#000000;">分享到...</td><td align="right" style="text-align:right;"><img src="./09_files/img_exit.gif" border="0" style="opacity:0.5;filter:alpha(opacity=50);margin:0 10px;cursor:pointer;" onclick="$CKE.shareClose();"></td></tr></tbody></table></div><div class="jiadiv_02" style="width:100%;" id="jiathis_sers"><a href="javascript:;" onclick="jiathis_sendto(&#39;copy&#39;);return false;" class="jiatitle"><span class="jtico jtico_copy">复制网址</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;email&#39;);return false;" class="jiatitle"><span class="jtico jtico_email">邮件</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qzone&#39;);return false;" class="jiatitle"><span class="jtico jtico_qzone">QQ空间</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tsina&#39;);return false;" class="jiatitle"><span class="jtico jtico_tsina">新浪微博</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_tqq">腾讯微博<img src="./09_files/gift.png" style="margin-top:-9px!important;_margin-top:-5px; margin-left:3px;"></span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;msn&#39;);return false;" class="jiatitle"><span class="jtico jtico_msn">MSN</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;renren&#39;);return false;" class="jiatitle"><span class="jtico jtico_renren">人人网</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;kaixin001&#39;);return false;" class="jiatitle"><span class="jtico jtico_kaixin001">开心网</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;t163&#39;);return false;" class="jiatitle"><span class="jtico jtico_t163">网易微博</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tsohu&#39;);return false;" class="jiatitle"><span class="jtico jtico_tsohu">搜狐微博</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_cqq">QQ好友</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;taobao&#39;);return false;" class="jiatitle"><span class="jtico jtico_taobao">淘江湖</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;feixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_feixin">飞信</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;douban&#39;);return false;" class="jiatitle"><span class="jtico jtico_douban">豆瓣</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ishare&#39;);return false;" class="jiatitle"><span class="jtico jtico_ishare">一键分享</span></a><a href="javascript:;" onclick="$CKE.center(this);return false;" class="jiatitle"><span class="jtico jtico_jiathis">查看更多(124)</span></a><div style="clear:both"></div></div><div class="ckepopBottom" style="width:100%;"><div style="float:left;font-size:10px"><a href="http://www.jiathis.com/help/html/what-is-jiathis" class="link_01" style="color:#333333;" target="_blank">这是什么工具?</a></div><div style="float:right;font-size:11px;margin:0 5px 0 0;"><img src="./09_files/img_012.gif" align="absmiddle" border="0"><a href="http://www.jiathis.com/index2" style="color:#333333;padding:0 3px;" class="link_01" target="_blank">JiaThis</a></div><div style="clear:both"></div></div></div></div></td></tr></tbody></table></div><iframe style="position: absolute; display: none;" frameborder="0"></iframe><div class="jiathis_style" style="height: auto; position: absolute; z-index: 100000000; display: none; top: 50%; left: 50%; overflow: auto;"><div style="border:10px solid #7F7F7F; width:300px;"><div class="jiadiv_01" style="width:300px;"><div style="background:#F2F2F2;line-height:100%;height:30px;overflow:hidden;width:300px;"><table width="100%" style="margin:5px 0 0 0;"><tbody><tr class="jt_sharetitle" style="line-height:20px!important;"><td align="left" style="text-align:left;font-size:12px;">分享到各大网站</td><td align="right"><img src="./09_files/img_exit.gif" border="0" style="margin:0 4px;cursor:pointer;" onclick="$CKE.centerClose();"></td></tr></tbody></table></div><div class="searchTxtCont"><div style="background:url(http://v2.jiathis.com/code/images/img_so.gif) no-repeat center;height:30px; width:281px"><form onsubmit="return false;"><input class="searchTxt" name="" type="text" onclick="this.value=&#39;&#39;;this.style.color=&#39;#000&#39;;" value="输入网站名或拼音缩写" onkeyup="$CKE.choose(this);"></form></div></div><div id="jiathis_sharelist" class="jiadiv_02" style="width:300px;height:300px;overflow-y:auto;"><a href="javascript:;" onclick="jiathis_sendto(&#39;ishare&#39;);return false;" class="jiatitle"><span class="jtico jtico_ishare">一键分享</span><input type="hidden" value="ishare,一键分享,yjfx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ujian&#39;);return false;" class="jiatitle"><span class="jtico jtico_ujian">猜你喜欢</span><input type="hidden" value="ujian,猜你喜欢,cnxh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;copy&#39;);return false;" class="jiatitle"><span class="jtico jtico_copy">复制网址</span><input type="hidden" value="copy,复制网址,fzwz"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fav&#39;);return false;" class="jiatitle"><span class="jtico jtico_fav">收藏夹</span><input type="hidden" value="fav,收藏夹,scj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;print&#39;);return false;" class="jiatitle"><span class="jtico jtico_print">打印</span><input type="hidden" value="print,打印,dy"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;email&#39;);return false;" class="jiatitle"><span class="jtico jtico_email">邮件</span><input type="hidden" value="email,邮件,yj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qzone&#39;);return false;" class="jiatitle"><span class="jtico jtico_qzone">QQ空间</span><input type="hidden" value="qzone,QQ空间,qqkj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tsina&#39;);return false;" class="jiatitle"><span class="jtico jtico_tsina">新浪微博</span><input type="hidden" value="tsina,新浪微博,xlwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_tqq">腾讯微博</span><input type="hidden" value="tqq,腾讯微博,txwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tsohu&#39;);return false;" class="jiatitle"><span class="jtico jtico_tsohu">搜狐微博</span><input type="hidden" value="tsohu,搜狐微博,shwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;t163&#39;);return false;" class="jiatitle"><span class="jtico jtico_t163">网易微博</span><input type="hidden" value="t163,网易微博,wywb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;renren&#39;);return false;" class="jiatitle"><span class="jtico jtico_renren">人人网</span><input type="hidden" value="renren,人人网,rrw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;kaixin001&#39;);return false;" class="jiatitle"><span class="jtico jtico_kaixin001">开心网</span><input type="hidden" value="kaixin001,开心网,kxw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;googleplus&#39;);return false;" class="jiatitle"><span class="jtico jtico_googleplus">Google+</span><input type="hidden" value="googleplus,Google+,googlej"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qingbiji&#39;);return false;" class="jiatitle"><span class="jtico jtico_qingbiji">轻笔记</span><input type="hidden" value="qingbiji,轻笔记,qbj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;taobao&#39;);return false;" class="jiatitle"><span class="jtico jtico_taobao">淘江湖</span><input type="hidden" value="taobao,淘江湖,tjh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;douban&#39;);return false;" class="jiatitle"><span class="jtico jtico_douban">豆瓣</span><input type="hidden" value="douban,豆瓣,db"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;xiaoyou&#39;);return false;" class="jiatitle"><span class="jtico jtico_xiaoyou">朋友网</span><input type="hidden" value="xiaoyou,朋友网,pyw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;sdonote&#39;);return false;" class="jiatitle"><span class="jtico jtico_sdonote">麦库记事</span><input type="hidden" value="sdonote,麦库记事,mkjs"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;baidu&#39;);return false;" class="jiatitle"><span class="jtico jtico_baidu">百度搜藏</span><input type="hidden" value="baidu,百度搜藏,bdsc"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ydnote&#39;);return false;" class="jiatitle"><span class="jtico jtico_ydnote">有道云笔记</span><input type="hidden" value="ydnote,有道云笔记,ydybj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;189share&#39;);return false;" class="jiatitle"><span class="jtico jtico_189share">手机快传</span><input type="hidden" value="189share,手机快传,sjkc"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tianya&#39;);return false;" class="jiatitle"><span class="jtico jtico_tianya">天涯社区</span><input type="hidden" value="tianya,天涯社区,tysq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;feixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_feixin">飞信</span><input type="hidden" value="feixin,飞信,fx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tieba&#39;);return false;" class="jiatitle"><span class="jtico jtico_tieba">百度贴吧</span><input type="hidden" value="tieba,百度贴吧,bdtb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tifeng&#39;);return false;" class="jiatitle"><span class="jtico jtico_tifeng">凤凰微博</span><input type="hidden" value="tifeng,凤凰微博,fhwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;youshi&#39;);return false;" class="jiatitle"><span class="jtico jtico_youshi">优士网</span><input type="hidden" value="youshi,优士网,ysw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fanfou&#39;);return false;" class="jiatitle"><span class="jtico jtico_fanfou">饭否</span><input type="hidden" value="fanfou,饭否,ff"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;diandian&#39;);return false;" class="jiatitle"><span class="jtico jtico_diandian">点点网</span><input type="hidden" value="diandian,点点网,ddw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mingdao&#39;);return false;" class="jiatitle"><span class="jtico jtico_mingdao">明道</span><input type="hidden" value="mingdao,明道,md"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;51&#39;);return false;" class="jiatitle"><span class="jtico jtico_51">51社区</span><input type="hidden" value="51,51社区,51sq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qileke&#39;);return false;" class="jiatitle"><span class="jtico jtico_qileke">奇乐收藏</span><input type="hidden" value="qileke,奇乐收藏,qlsc"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;google&#39;);return false;" class="jiatitle"><span class="jtico jtico_google">谷歌</span><input type="hidden" value="google,谷歌,gg"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;buzz&#39;);return false;" class="jiatitle"><span class="jtico jtico_buzz">谷歌Buzz</span><input type="hidden" value="buzz,谷歌Buzz,ggbuzz"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;youdao&#39;);return false;" class="jiatitle"><span class="jtico jtico_youdao">有道书签</span><input type="hidden" value="youdao,有道书签,ydsq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_cqq">QQ好友</span><input type="hidden" value="cqq,QQ好友,cqq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qq&#39;);return false;" class="jiatitle"><span class="jtico jtico_qq">QQ书签</span><input type="hidden" value="qq,QQ书签,qqsq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;msn&#39;);return false;" class="jiatitle"><span class="jtico jtico_msn">MSN</span><input type="hidden" value="msn,MSN,msn"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pinterest&#39;);return false;" class="jiatitle"><span class="jtico jtico_pinterest">Pinterest</span><input type="hidden" value="pinterest,Pinterest,pinterest"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;huaban&#39;);return false;" class="jiatitle"><span class="jtico jtico_huaban">花瓣网</span><input type="hidden" value="huaban,花瓣网,hbw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;duitang&#39;);return false;" class="jiatitle"><span class="jtico jtico_duitang">堆糖</span><input type="hidden" value="duitang,堆糖,dt"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ifensi&#39;);return false;" class="jiatitle"><span class="jtico jtico_ifensi">粉丝网</span><input type="hidden" value="ifensi,粉丝网,fsw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tyaolan&#39;);return false;" class="jiatitle"><span class="jtico jtico_tyaolan">摇篮微博</span><input type="hidden" value="tyaolan,摇篮微博,ylwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;115&#39;);return false;" class="jiatitle"><span class="jtico jtico_115">115收藏</span><input type="hidden" value="115,115收藏,115sc"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;hi&#39;);return false;" class="jiatitle"><span class="jtico jtico_hi">百度空间</span><input type="hidden" value="hi,百度空间,bdkj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;gmail&#39;);return false;" class="jiatitle"><span class="jtico jtico_gmail">Gmail邮箱</span><input type="hidden" value="gmail,Gmail邮箱,gmailyx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;hotmail&#39;);return false;" class="jiatitle"><span class="jtico jtico_hotmail">Hotmail邮箱</span><input type="hidden" value="hotmail,Hotmail邮箱,hotmailyx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ymail&#39;);return false;" class="jiatitle"><span class="jtico jtico_ymail">Yahoo! mail</span><input type="hidden" value="ymail,Yahoo! mail,yahoo! mail"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;hexun&#39;);return false;" class="jiatitle"><span class="jtico jtico_hexun">和讯</span><input type="hidden" value="hexun,和讯,hx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;toeeee&#39;);return false;" class="jiatitle"><span class="jtico jtico_toeeee">南方微博</span><input type="hidden" value="toeeee,南方微博,nfwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;139mail&#39;);return false;" class="jiatitle"><span class="jtico jtico_139mail">139邮箱</span><input type="hidden" value="139mail,139邮箱,139yx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;189mail&#39;);return false;" class="jiatitle"><span class="jtico jtico_189mail">189邮箱</span><input type="hidden" value="189mail,189邮箱,189yx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;i139&#39;);return false;" class="jiatitle"><span class="jtico jtico_i139">爱分享</span><input type="hidden" value="i139,爱分享,afx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;iwo&#39;);return false;" class="jiatitle"><span class="jtico jtico_iwo">WO+分享</span><input type="hidden" value="iwo,WO+分享,iwo"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;189cn&#39;);return false;" class="jiatitle"><span class="jtico jtico_189cn">天翼社区</span><input type="hidden" value="189cn,天翼社区,tysq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;139&#39;);return false;" class="jiatitle"><span class="jtico jtico_139">移动微博</span><input type="hidden" value="139,移动微博,ydwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tpeople&#39;);return false;" class="jiatitle"><span class="jtico jtico_tpeople">人民微博</span><input type="hidden" value="tpeople,人民微博,rmwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cnfol&#39;);return false;" class="jiatitle"><span class="jtico jtico_cnfol">中金微博</span><input type="hidden" value="cnfol,中金微博,zjwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;txinhua&#39;);return false;" class="jiatitle"><span class="jtico jtico_txinhua">新华微博</span><input type="hidden" value="txinhua,新华微博,xhwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;caimi&#39;);return false;" class="jiatitle"><span class="jtico jtico_caimi">财迷</span><input type="hidden" value="caimi,财迷,cm"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;translate&#39;);return false;" class="jiatitle"><span class="jtico jtico_translate">谷歌翻译</span><input type="hidden" value="translate,谷歌翻译,ggfy"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tuita&#39;);return false;" class="jiatitle"><span class="jtico jtico_tuita">推他</span><input type="hidden" value="tuita,推他,tt"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mop&#39;);return false;" class="jiatitle"><span class="jtico jtico_mop">猫扑推客</span><input type="hidden" value="mop,猫扑推客,mptk"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;digu&#39;);return false;" class="jiatitle"><span class="jtico jtico_digu">嘀咕网</span><input type="hidden" value="digu,嘀咕网,dgw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;xianguo&#39;);return false;" class="jiatitle"><span class="jtico jtico_xianguo">鲜果</span><input type="hidden" value="xianguo,鲜果,xg"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;faxianla&#39;);return false;" class="jiatitle"><span class="jtico jtico_faxianla">发现啦</span><input type="hidden" value="faxianla,发现啦,fxl"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ganniu&#39;);return false;" class="jiatitle"><span class="jtico jtico_ganniu">赶牛网</span><input type="hidden" value="ganniu,赶牛网,gnw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;42qu&#39;);return false;" class="jiatitle"><span class="jtico jtico_42qu">42区</span><input type="hidden" value="42qu,42区,42q"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;miliao&#39;);return false;" class="jiatitle"><span class="jtico jtico_miliao">米聊</span><input type="hidden" value="miliao,米聊,ml"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;kansohu&#39;);return false;" class="jiatitle"><span class="jtico jtico_kansohu">搜狐随身看</span><input type="hidden" value="kansohu,搜狐随身看,shssk"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qingsina&#39;);return false;" class="jiatitle"><span class="jtico jtico_qingsina">新浪轻博</span><input type="hidden" value="qingsina,新浪轻博,xlqb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ifengkb&#39;);return false;" class="jiatitle"><span class="jtico jtico_ifengkb">凤凰快博</span><input type="hidden" value="ifengkb,凤凰快博,fhkb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;jcrb&#39;);return false;" class="jiatitle"><span class="jtico jtico_jcrb">法律微博</span><input type="hidden" value="jcrb,法律微博,flwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;gmw&#39;);return false;" class="jiatitle"><span class="jtico jtico_gmw">光明网</span><input type="hidden" value="gmw,光明网,gmw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;renjian&#39;);return false;" class="jiatitle"><span class="jtico jtico_renjian">人间网</span><input type="hidden" value="renjian,人间网,rjw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;leihou&#39;);return false;" class="jiatitle"><span class="jtico jtico_leihou">雷猴网</span><input type="hidden" value="leihou,雷猴网,lhw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;thexun&#39;);return false;" class="jiatitle"><span class="jtico jtico_thexun">和讯微博</span><input type="hidden" value="thexun,和讯微博,hxwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;dream163&#39;);return false;" class="jiatitle"><span class="jtico jtico_dream163">游戏江湖</span><input type="hidden" value="dream163,游戏江湖,yxjh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;masar&#39;);return false;" class="jiatitle"><span class="jtico jtico_masar">玛撒网</span><input type="hidden" value="masar,玛撒网,msw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;binzhi&#39;);return false;" class="jiatitle"><span class="jtico jtico_binzhi">宾至网</span><input type="hidden" value="binzhi,宾至网,bzw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fb&#39;);return false;" class="jiatitle"><span class="jtico jtico_fb">Facebook</span><input type="hidden" value="fb,Facebook,facebook"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;twitter&#39;);return false;" class="jiatitle"><span class="jtico jtico_twitter">Twitter</span><input type="hidden" value="twitter,Twitter,twitter"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tumblr&#39;);return false;" class="jiatitle"><span class="jtico jtico_tumblr">Tumblr</span><input type="hidden" value="tumblr,Tumblr,tumblr"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;reddit&#39;);return false;" class="jiatitle"><span class="jtico jtico_reddit">Reddit</span><input type="hidden" value="reddit,Reddit,reddit"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;instapaper&#39;);return false;" class="jiatitle"><span class="jtico jtico_instapaper">Instapaper</span><input type="hidden" value="instapaper,Instapaper,instapaper"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;readitlater&#39;);return false;" class="jiatitle"><span class="jtico jtico_readitlater">Read It Later</span><input type="hidden" value="readitlater,Read It Later,readitlater"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;wealink&#39;);return false;" class="jiatitle"><span class="jtico jtico_wealink">若邻网</span><input type="hidden" value="wealink,若邻网,rlw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;leshou&#39;);return false;" class="jiatitle"><span class="jtico jtico_leshou">乐收</span><input type="hidden" value="leshou,乐收,ls"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;waakee&#39;);return false;" class="jiatitle"><span class="jtico jtico_waakee">挖客网</span><input type="hidden" value="waakee,挖客网,wkw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cyzone&#39;);return false;" class="jiatitle"><span class="jtico jtico_cyzone">创业邦</span><input type="hidden" value="cyzone,创业邦,cyb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;99earth&#39;);return false;" class="jiatitle"><span class="jtico jtico_99earth">救救地球</span><input type="hidden" value="99earth,救救地球,jjdq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;chouti&#39;);return false;" class="jiatitle"><span class="jtico jtico_chouti">抽屉网</span><input type="hidden" value="chouti,抽屉网,ctw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;dig24&#39;);return false;" class="jiatitle"><span class="jtico jtico_dig24">递客网</span><input type="hidden" value="dig24,递客网,dkw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;douban9dian&#39;);return false;" class="jiatitle"><span class="jtico jtico_douban9dian">豆瓣9点</span><input type="hidden" value="douban9dian,豆瓣9点,db9d"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;meilishuo&#39;);return false;" class="jiatitle"><span class="jtico jtico_meilishuo">美丽说</span><input type="hidden" value="meilishuo,美丽说,mls"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mogujie&#39;);return false;" class="jiatitle"><span class="jtico jtico_mogujie">蘑菇街</span><input type="hidden" value="mogujie,蘑菇街,mgj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tianji&#39;);return false;" class="jiatitle"><span class="jtico jtico_tianji">天际网</span><input type="hidden" value="tianji,天际网,tjw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;poco&#39;);return false;" class="jiatitle"><span class="jtico jtico_poco">Poco网</span><input type="hidden" value="poco,Poco网,pocow"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;baohe&#39;);return false;" class="jiatitle"><span class="jtico jtico_baohe">宝盒网</span><input type="hidden" value="baohe,宝盒网,bhw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;yijee&#39;);return false;" class="jiatitle"><span class="jtico jtico_yijee">易集网</span><input type="hidden" value="yijee,易集网,yjw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pdfonline&#39;);return false;" class="jiatitle"><span class="jtico jtico_pdfonline">Pdf在线转换</span><input type="hidden" value="pdfonline,Pdf在线转换,pdfzxzh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;printfriendly&#39;);return false;" class="jiatitle"><span class="jtico jtico_printfriendly">友好打印</span><input type="hidden" value="printfriendly,友好打印,yhdy"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;w3c&#39;);return false;" class="jiatitle"><span class="jtico jtico_w3c">W3c验证</span><input type="hidden" value="w3c,W3c验证,w3cyz"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;bitly&#39;);return false;" class="jiatitle"><span class="jtico jtico_bitly">Bit.ly</span><input type="hidden" value="bitly,Bit.ly,bitly"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;digg&#39;);return false;" class="jiatitle"><span class="jtico jtico_digg">Digg</span><input type="hidden" value="digg,Digg,digg"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mailru&#39;);return false;" class="jiatitle"><span class="jtico jtico_mailru">Mail.ru</span><input type="hidden" value="mailru,Mail.ru,mail.ru"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;diigo&#39;);return false;" class="jiatitle"><span class="jtico jtico_diigo">Diigo</span><input type="hidden" value="diigo,Diigo,diigo"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;evernote&#39;);return false;" class="jiatitle"><span class="jtico jtico_evernote">EverNote</span><input type="hidden" value="evernote,EverNote,evernote"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;friendfeed&#39;);return false;" class="jiatitle"><span class="jtico jtico_friendfeed">FriendFeed</span><input type="hidden" value="friendfeed,FriendFeed,friendfeed"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;myspace&#39;);return false;" class="jiatitle"><span class="jtico jtico_myspace">Myspace</span><input type="hidden" value="myspace,Myspace,myspace"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;linkedin&#39;);return false;" class="jiatitle"><span class="jtico jtico_linkedin">LinkedIn</span><input type="hidden" value="linkedin,LinkedIn,linkedin"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mixx&#39;);return false;" class="jiatitle"><span class="jtico jtico_mixx">Mixx</span><input type="hidden" value="mixx,Mixx,mixx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;netlog&#39;);return false;" class="jiatitle"><span class="jtico jtico_netlog">NetLog</span><input type="hidden" value="netlog,NetLog,netlog"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;netvibes&#39;);return false;" class="jiatitle"><span class="jtico jtico_netvibes">Netvibes</span><input type="hidden" value="netvibes,Netvibes,netvibes"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;phonefavs&#39;);return false;" class="jiatitle"><span class="jtico jtico_phonefavs">Phonefavs</span><input type="hidden" value="phonefavs,Phonefavs,phonefavs"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pingfm&#39;);return false;" class="jiatitle"><span class="jtico jtico_pingfm">Ping.fm</span><input type="hidden" value="pingfm,Ping.fm,ping.fm"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;plaxo&#39;);return false;" class="jiatitle"><span class="jtico jtico_plaxo">Plaxo</span><input type="hidden" value="plaxo,Plaxo,plaxo"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;delicious&#39;);return false;" class="jiatitle"><span class="jtico jtico_delicious">Delicious</span><input type="hidden" value="delicious,Delicious,delicious"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;wong&#39;);return false;" class="jiatitle"><span class="jtico jtico_wong">Mister Wong</span><input type="hidden" value="wong,Mister Wong,misterwong"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;stumbleupon&#39;);return false;" class="jiatitle"><span class="jtico jtico_stumbleupon">Stumbleupon</span><input type="hidden" value="stumbleupon,Stumbleupon,stumbleupon"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;plurk&#39;);return false;" class="jiatitle"><span class="jtico jtico_plurk">Plurk</span><input type="hidden" value="plurk,Plurk,plurk"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;funp&#39;);return false;" class="jiatitle"><span class="jtico jtico_funp">Funp</span><input type="hidden" value="funp,Funp,funp"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;myshare&#39;);return false;" class="jiatitle"><span class="jtico jtico_myshare">Myshare</span><input type="hidden" value="myshare,Myshare,myshare"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fwisp&#39;);return false;" class="jiatitle"><span class="jtico jtico_fwisp">Fwisp</span><input type="hidden" value="fwisp,Fwisp,fwisp"></a><div style="clear:both"></div></div><div class="centerBottom"><div style="float:left;font-size:10px;"><a href="http://www.jiathis.com/help/html/what-is-jiathis" class="link_01" style="color:#333333;" target="_blank">这是什么工具?</a></div><div style="float:right;font-size:11px;margin:0 10px 0 0;"><img src="./09_files/img_012.gif" align="absmiddle" border="none">&nbsp;<a href="http://www.jiathis.com/index2" style="color:#333333;" class="link_01" target="_blank">JiaThis</a></div><div style="clear:both"></div></div></div></div></div><iframe style="display: none;" frameborder="0" src="./09_files/jiathis_utility.htm"></iframe>
<a name="top"></a>
<!--PageBeginHtml Block Begin-->
<script type="text/javascript" src="http://www.luminate.com/widget/107193fa6e0/"></script>

<!--PageBeginHtml Block End-->


<div id="container">
    <a class="minyx" href="http://www.spiga.com.mx/">Spiga</a>
    <ul id="topMnu">
        <!-- 统计数据 -->
        <li>
        
            
Posts - 159, 
Articles - 0, 
Comments - 154
<!---->            
        
        </li>
        <!-- 这边可以增加一些链接 -->
        <!-- 博客园 -->
        <li><a href="http://www.cnblogs.com/">Cnblogs</a></li>
        <!-- 管理 -->
        <li id="topMnu-dashboard"><a id="lnkDashboard" href="http://www.cnblogs.com/aga-j/admin/EditPosts.aspx">Dashboard</a></li>
        <li><a id="lnkLogin" href="http://passport.cnblogs.com/login.aspx?ReturnUrl=http://www.cnblogs.com/aga-j/archive/2011/09/18/2180658.html">Login</a></li>
    </ul>
    
    <script language="javascript" type="text/javascript">
        var m = window.__blog.topMenuRendered;
        if (m) { m(__$("topMnu")); }
    </script>

    <div id="header">
        <ul id="menu">
                <!-- 首页，当前section加上current类 -->
                <li id="menu-home" class="current"><a id="lnkHome" href="http://www.cnblogs.com/aga-j/">Home</a></li>
                <!-- 联系 -->
                <li id="menu-contact"><a id="lnkContact" href="http://space.cnblogs.com/msg/send/Aga.J">Contact</a></li>
                <!-- 相册 -->
                <li id="menu-gallary"><a id="lnkGallery" href="http://www.cnblogs.com/aga-j/gallery.html">Gallery</a></li>
                <!-- Rss订阅 -->
                <li id="rss"><a id="lnkRss" href="http://www.cnblogs.com/aga-j/rss">RSS</a></li>
        </ul>
	<div id="newmsg"></div>
        <h1>
            <!-- 主标题 -->
            <a id="lnkBlogTitle" href="http://www.cnblogs.com/aga-j/">Aga.J</a>
            <!-- 子标题 -->
            <small>键盘，琴盘，指尖，狂弹</small>
        </h1>
    </div>
    
    <script language="javascript" type="text/javascript">
        var m = window.__blog.headerRendered;
        if (m) { m(__$("header")); }
    </script>
        
    <div id="wrapper"> 
        <div id="content">
             <script language="javascript" type="text/javascript">
                        var m = window.__blog.preRenderPosts;
                        if (m) { m(); } 
            </script>
            
	
<div class="post" id="post"><a name="top"></a>
    <h2>
        <a id="ctl01_lnkTitle" href="./09_files/09.htm">Linux TCP server系列（7）-select模式下的prefork server</a></h2>
    <small>
        2011-09-18 21:11
        by
        Aga.J,
        354
        阅读,
        <span id="post-comment-count">0</span>
        评论,
        <a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180658.html#" onclick="PutInWz();return false;">收藏</a>,
        <a id="ctl01_lnkEdit" href="http://www.cnblogs.com/aga-j/admin/EditPosts.aspx?postid=2180658">编辑</a></small>
    <div class="entry">
        <div id="cnblogs_post_body"><p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><strong><span style="font-family: 宋体; font-size: 24pt; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">目标：</span></strong><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Calibri;" face="Calibri">&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">多进程服务器的性能提升。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Calibri;" face="Calibri">&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">前面介绍过一种</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">server</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">模式为每个客户端连接都创建一个子进程，这种方式对</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">server</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的压力较大，首先创建进程会消耗时间，其次，进程没有办法得到重复利用也会浪费了进程的创建，最后，进程间切换会带来性能上的影响。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Calibri;" face="Calibri">&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">本程序使用</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">prefork</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">思想，预先为</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">server</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">派生多个子进程，方便在需要时可以马上使用，而不需要等待进程创建，同时，进程还可以重复使用。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><o:p><span style="font-family: Calibri;" face="Calibri">&nbsp;</span></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><strong><span style="font-family: 宋体; font-size: 24pt; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">思路：</span></strong><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Calibri;" face="Calibri">&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">程序预先</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">fork</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">多个子进程，用来处理每个客户端</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的信息交互或者请求（<span style="color: red;">决定预先</span></span><span style="color: red;" lang="EN-US"><span style="font-family: Calibri;" face="Calibri">fork</span></span><span style="color: red; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">多少个子进程是个问题！</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">）一开始<span style="color: red;">每个子进程都阻塞在和父进程的通信通道</span>上，等待父进程的消息通知</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">(</span></span><span style="color: red; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">处理某个客户请求</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">)</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">，然后才执行与客户端</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的交互。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt; text-indent: 10.5pt; mso-char-indent-count: 1.0;" class="MsoNormal"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">所有</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">accept</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">操作由“父进程”完成接收到客户端连接</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">后，将该</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的文件描述符传送给子进程（怎么传送是一个问题！这里使用域</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">来作为父子进程之间的通信介质</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">—<span style="color: red;">Unix</span></span></span><span style="color: red; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">域可以做到让同一台主机上的任何一个进程向其他进程传递打开的文件描述符，进程间用</span><span style="color: red;" lang="EN-US"><span style="font-family: Calibri;" face="Calibri">sendmsg</span></span><span style="color: red; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">在域套接口上发送一个特殊的消息，然后由内核做特殊处理，最后完成将打开的描述字从发送方传递到接收方，同时</span><span style="color: red;" lang="EN-US"><span style="font-family: Calibri;" face="Calibri">Unix</span></span><span style="color: red; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">域套接口也可以作为同一台主机上</span><span style="color: red;" lang="EN-US"><span style="font-family: Calibri;" face="Calibri">IPC</span></span><span style="color: red; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">通信的另一种方式，而且性能速度通常是</span><span style="color: red;" lang="EN-US"><span style="font-family: Calibri;" face="Calibri">TCP</span></span><span style="color: red; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">套接口的两倍【两个好处：速度快，可传递套接字】</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">）。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-spacerun: yes;">&nbsp;</span><span style="color: red;"><span style="mso-spacerun: yes;">&nbsp;</span></span></span></span><span style="color: red; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">同时，父进程还会使用</span><span style="color: red;" lang="EN-US"><span style="font-family: Calibri;" face="Calibri">select</span></span><span style="color: red; font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">来监听所有孩子的通信介质</span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">，当子进程完成了客户端</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的信息交互请求后，就会通过该通信介质通知父进程，父进程在</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">select</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">捕获到消息后，则将发出该消息的子进程标识为空闲状态。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-spacerun: yes;">&nbsp; </span><o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><strong><span style="font-family: 宋体; font-size: 24pt; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">实现：</span></strong><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt; text-indent: 10.5pt; mso-char-indent-count: 1.0;" class="MsoNormal"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">（</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">1</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">）父进程为了获知或者控制子进程，所以需要定义一个结构来维护子进程的信息</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 10.5pt; mso-para-margin-left: 1.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-spacerun: yes;">&nbsp; </span>typedef struct<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">{<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-spacerun: yes;">&nbsp; </span>pid_t<span style="mso-spacerun: yes;">&nbsp; </span>child_pid;<span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp;
</span>//</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进程</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">ID<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-spacerun: yes;">&nbsp; </span>int<span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span>child_pipefd;<span style="mso-spacerun: yes;">&nbsp; </span>//</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">父子间的</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">stream pipe</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">（连接父子进程的字节流管道描述字）</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-spacerun: yes;">&nbsp; </span>int<span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span>child_status;<span style="mso-spacerun: yes;">&nbsp; </span>//</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">状态</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-spacerun: yes;">&nbsp; </span>long<span style="mso-spacerun: yes;">&nbsp;&nbsp; </span>child_count;<span style="mso-spacerun: yes;">&nbsp;
</span>//</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">已处理的客户数</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">} Child;<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 10.5pt; mso-para-margin-left: 1.0gd;" class="MsoNormal"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">（</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">2</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">）</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">prefork<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 10.5pt; mso-para-margin-left: 1.0gd;" class="MsoNormal"><span lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Calibri;" face="Calibri">&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">创建一定数量的子进程，同时每个子进程需要开启一条通道以便于和父进程做消息传递。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">//initial "server 0.5" element<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>nchildren=10;<span style="mso-spacerun: yes;">&nbsp;&nbsp; </span>//</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">假设接收</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">10</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">个</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>navail=nchildren;<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cptr=(Child*)calloc(nchildren,sizeof(Child));<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>for(i=0;i&lt;nchildren;i++)<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>child_make(i,listenfd,addrlen);<span style="mso-spacerun: yes;">&nbsp;&nbsp; </span><o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>//</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">注意</span><span style="font-family: Calibri;" face="Calibri"> </span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">这时候父进程还没有所谓的进程描述表项存在，没有所谓的文件打开描述结构</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>FD_SET(cptr[i].child_pipefd,&amp;allset);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>maxfd=std::max(maxfd,cptr[i].child_pipefd);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>//initial "server
0.5" element<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><o:p><span style="font-family: Calibri;" face="Calibri">&nbsp;</span></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 21pt; mso-para-margin-left: 2.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-spacerun: yes;">&nbsp; </span>//child_make</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">实现</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">pid_t child_make(int i, int listenfd, int addrlen)<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">{<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>int sockfd[2];<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>pid_t pid;<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><o:p><span style="font-family: Calibri;" face="Calibri">&nbsp;</span></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>void
child_main(int,int,int);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><o:p><span style="font-family: Calibri;" face="Calibri">&nbsp;</span></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>socketpair(AF_LOCAL,SOCK_STREAM,0,sockfd);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>if ( (pid=fork())&gt;0)<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>close(sockfd[1]);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cptr[i].child_pid=pid;<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cptr[i].child_pipefd=sockfd[0];<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>cptr[i].child_status=0;<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return pid;<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><o:p><span style="font-family: Calibri;" face="Calibri">&nbsp;</span></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>dup2(sockfd[1],STDERR_FILENO);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>close(sockfd[0]);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>close(sockfd[1]);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>close(listenfd);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span>child_main(i,listenfd,addrlen);<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 31.5pt; mso-para-margin-left: 3.0gd;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">}<o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt 10.5pt; mso-para-margin-left: 1.0gd;" class="MsoNormal"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="font-family: Calibri;" face="Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">注意到，子进程和父进程之间的通信通道是</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">Unix</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">域</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">，这也是一种</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">IPC</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的方式，而且它很适合进程在同一台机器上的情况，注意上述代码中对每个接口都很小心的做了处理（关闭等）。完成创建后，子进程执行</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">child_main</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">阻塞在</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">Unix</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">域</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的信息</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">recv</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">上。（父进程这时候只需要发送新接收的客户端</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket fd</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">即可以让子进程马上进行相应的处理）。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt; text-indent: 10.5pt; mso-char-indent-count: 1.0;" class="MsoNormal"><span style="font-family: Calibri;" face="Calibri"><span style="mso-no-proof: yes;" lang="EN-US"><v:shapetype id="_x0000_t75" stroked="f" filled="f" path="m@4@5l@4@11@9@11@9@5xe" o:preferrelative="t" o:spt="75" coordsize="21600,21600">
 <v:stroke joinstyle="miter">
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0">
  <v:f eqn="sum @0 1 0">
  <v:f eqn="sum 0 0 @1">
  <v:f eqn="prod @2 1 2">
  <v:f eqn="prod @3 21600 pixelWidth">
  <v:f eqn="prod @3 21600 pixelHeight">
  <v:f eqn="sum @0 0 1">
  <v:f eqn="prod @6 1 2">
  <v:f eqn="prod @7 21600 pixelWidth">
  <v:f eqn="sum @8 21600 0">
  <v:f eqn="prod @7 21600 pixelHeight">
  <v:f eqn="sum @10 21600 0">
 </v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:formulas>
 <v:path o:connecttype="rect" gradientshapeok="t" o:extrusionok="f">
 <o:lock aspectratio="t" v:ext="edit">
</o:lock></v:path></v:stroke></v:shapetype><v:shape style="width: 236.25pt; height: 66pt; visibility: visible; mso-wrap-style: square;" id="图片_x0020_1" type="#_x0000_t75" o:spid="_x0000_i1025">
 <v:imagedata o:title="" src="file:///C:\Users\aga\AppData\Local\Temp\msohtmlclip1\01\clip_image001.png">
</v:imagedata></v:shape></span><span lang="EN-US"><o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="mso-tab-count: 1;"><span style="font-family: Calibri;" face="Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">（</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">3</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">）父进程监听和消息通知</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="font-family: Calibri;" face="Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">所有子进程创建后，父进程还需要监听和各个子进程的通信</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">fd</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">，因为每个子进程处理完父进程分配给他们的任务后，要告诉父进程，这样父进程就可以标识子进程为可用，从而做到复用子进程。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="mso-tab-count: 2;"><span style="font-family: Calibri;" face="Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">同时父进程当然也会监听</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">listen
socket</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">fd</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">，一旦有新连接来，它就会选取一个空闲子进程，然后通过</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">unix</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">域套接字将新连接</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">socket fd</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">作为消息发送给子进程。</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="mso-spacerun: yes;"><span style="font-family: Calibri;" face="Calibri">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">这里的</span><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri">Unix</span></span><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">域通信实现参考自网络</span><span lang="EN-US"><o:p></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><span style="mso-tab-count: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;2047418a-2804-4fb3-a4fb-5c1b6afbb092&#39;)"><img id="code_img_closed_2047418a-2804-4fb3-a4fb-5c1b6afbb092" class="code_img_closed" src="./09_files/ContractedBlock.gif" style="display: none;"><img style="" id="code_img_opened_2047418a-2804-4fb3-a4fb-5c1b6afbb092" class="code_img_opened" onclick="cnblogs_code_hide(&#39;2047418a-2804-4fb3-a4fb-5c1b6afbb092&#39;,event)" src="./09_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse">recv_fd</span>
<div id="cnblogs_code_open_2047418a-2804-4fb3-a4fb-5c1b6afbb092" class="cnblogs_code_hide" style="display: block;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./09_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #000000;">size_t recv_fd(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> fd, </span><span style="color: #0000ff;">void</span><span style="color: #000000;">*</span><span style="color: #000000;">data, size_t bytes, </span><span style="color: #0000ff;">int</span><span style="color: #000000;">*</span><span style="color: #000000;">recvfd)<br></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{  <br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> msghdr msghdr_recv; </span><span style="color: #008000;">/*</span><span style="color: #008000;">接收消息接收</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> iovec iov[</span><span style="color: #800080;">1</span><span style="color: #000000;">]; </span><span style="color: #008000;">/*</span><span style="color: #008000;">接收数据的向量</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">    size_t n;  <br></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> newfd; <br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    union{   <br></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> cmsghdr cm;<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">        </span><span style="color: #0000ff;">char</span><span style="color: #000000;"> control[CMSG_SPACE(</span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">))]; <br></span><span style="color: #008080;">10</span> <span style="color: #000000;">    }control_un; <br></span><span style="color: #008080;">11</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> cmsghdr</span><span style="color: #000000;">*</span><span style="color: #000000;">pcmsghdr; </span><span style="color: #008000;">/*</span><span style="color: #008000;">消息头部</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">12</span> <span style="color: #000000;">    msghdr_recv.msg_control </span><span style="color: #000000;">=</span><span style="color: #000000;"> control_un.control; </span><span style="color: #008000;">/*</span><span style="color: #008000;">控制消息</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">13</span> <span style="color: #000000;">    msghdr_recv.msg_controllen </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(control_un.control); </span><span style="color: #008000;">/*</span><span style="color: #008000;">控制消息的长度</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">14</span> <span style="color: #000000;">    msghdr_recv.msg_name </span><span style="color: #000000;">=</span><span style="color: #000000;"> NULL; </span><span style="color: #008000;">/*</span><span style="color: #008000;">消息的名称为空</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">15</span> <span style="color: #000000;">    msghdr_recv.msg_namelen </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; </span><span style="color: #008000;">/*</span><span style="color: #008000;">消息的长度为空</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">16</span> <span style="color: #000000;"><br></span><span style="color: #008080;">17</span> <span style="color: #000000;">    iov[</span><span style="color: #800080;">0</span><span style="color: #000000;">].iov_base </span><span style="color: #000000;">=</span><span style="color: #000000;"> data; </span><span style="color: #008000;">/*</span><span style="color: #008000;">向量的数据为传入的数据</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">18</span> <span style="color: #000000;">    iov[</span><span style="color: #800080;">0</span><span style="color: #000000;">].iov_len </span><span style="color: #000000;">=</span><span style="color: #000000;"> bytes; </span><span style="color: #008000;">/*</span><span style="color: #008000;">向量的长度为传入数据的长度</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    msghdr_recv.msg_iov </span><span style="color: #000000;">=</span><span style="color: #000000;"> iov; </span><span style="color: #008000;">/*</span><span style="color: #008000;">消息向量指针</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">20</span> <span style="color: #000000;">    msghdr_recv.msg_iovlen </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">; </span><span style="color: #008000;">/*</span><span style="color: #008000;">消息向量的个数为1个</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">21</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">if</span><span style="color: #000000;">((n </span><span style="color: #000000;">=</span><span style="color: #000000;"> recvmsg(fd, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">msghdr_recv, </span><span style="color: #800080;">0</span><span style="color: #000000;">))</span><span style="color: #000000;">&lt;=</span><span style="color: #800080;">0</span><span style="color: #000000;">) </span><span style="color: #008000;">/*</span><span style="color: #008000;">接收消息</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">22</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> n;  <br></span><span style="color: #008080;">23</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">if</span><span style="color: #000000;">((pcmsghdr </span><span style="color: #000000;">=</span><span style="color: #000000;"> CMSG_FIRSTHDR(</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">msghdr_recv))</span><span style="color: #000000;">!=</span><span style="color: #000000;"> NULL </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> </span><span style="color: #008000;">/*</span><span style="color: #008000;">获得消息的头部</span><span style="color: #008000;">*/</span><span style="color: #000000;">      <br></span><span style="color: #008080;">24</span> <span style="color: #000000;">            pcmsghdr</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">cmsg_len </span><span style="color: #000000;">==</span><span style="color: #000000;"> CMSG_LEN(</span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">))) { </span><span style="color: #008000;">/*</span><span style="color: #008000;">获得消息的长度为int</span><span style="color: #008000;">*/</span><span style="color: #000000;">        <br></span><span style="color: #008080;">25</span> <span style="color: #000000;">        </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(pcmsghdr</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">cmsg_level </span><span style="color: #000000;">!=</span><span style="color: #000000;"> SOL_SOCKET) </span><span style="color: #008000;">/*</span><span style="color: #008000;">消息的level应该为SOL_SOCKET</span><span style="color: #008000;">*/</span><span style="color: #000000;">                printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">control level != SOL_SOCKET\n</span><span style="color: #800000;">"</span><span style="color: #000000;">);    <br></span><span style="color: #008080;">26</span> <span style="color: #000000;">        </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(pcmsghdr</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">cmsg_type </span><span style="color: #000000;">!=</span><span style="color: #000000;"> SCM_RIGHTS) </span><span style="color: #008000;">/*</span><span style="color: #008000;">消息的类型判断</span><span style="color: #008000;">*/</span><span style="color: #000000;">        <br></span><span style="color: #008080;">27</span> <span style="color: #000000;">        printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">control type != SCM_RIGHTS\n</span><span style="color: #800000;">"</span><span style="color: #000000;">);    <br></span><span style="color: #008080;">28</span> <span style="color: #000000;">        </span><span style="color: #000000;">*</span><span style="color: #000000;">recvfd </span><span style="color: #000000;">=*</span><span style="color: #000000;">((</span><span style="color: #0000ff;">int</span><span style="color: #000000;">*</span><span style="color: #000000;">)CMSG_DATA(pcmsghdr)); </span><span style="color: #008000;">/*</span><span style="color: #008000;">获得打开文件的描述符</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;">29</span> <span style="color: #000000;">    } </span><span style="color: #0000ff;">else</span><span style="color: #000000;">    <br></span><span style="color: #008080;">30</span> <span style="color: #000000;">    </span><span style="color: #000000;">*</span><span style="color: #000000;">recvfd </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">;  <br></span><span style="color: #008080;">31</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> n; </span><span style="color: #008000;">/*</span><span style="color: #008000;">返回接收消息的长度</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">32</span> <span style="color: #000000;">}</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./09_files/copycode.gif" alt="复制代码"></a></span></div></div>
</div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;0cdb29e6-1093-4528-b4c6-162a33efe8fb&#39;)"><img id="code_img_closed_0cdb29e6-1093-4528-b4c6-162a33efe8fb" class="code_img_closed" src="./09_files/ContractedBlock.gif" style="display: none;"><img style="" id="code_img_opened_0cdb29e6-1093-4528-b4c6-162a33efe8fb" class="code_img_opened" onclick="cnblogs_code_hide(&#39;0cdb29e6-1093-4528-b4c6-162a33efe8fb&#39;,event)" src="./09_files/ExpandedBlockStart.gif"><span class="cnblogs_code_collapse">send_fd</span>
<div id="cnblogs_code_open_0cdb29e6-1093-4528-b4c6-162a33efe8fb" class="cnblogs_code_hide" style="display: block;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./09_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1</span> <span style="color: #000000;">ssize_t send_fd(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> fd, </span><span style="color: #0000ff;">void</span><span style="color: #000000;">*</span><span style="color: #000000;">data, size_t bytes, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> sendfd)<br></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{  <br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> msghdr msghdr_send; </span><span style="color: #008000;">/*</span><span style="color: #008000;">发送消息</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> iovec iov[</span><span style="color: #800080;">1</span><span style="color: #000000;">]; </span><span style="color: #008000;">/*</span><span style="color: #008000;">向量</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">    size_t n; </span><span style="color: #008000;">/*</span><span style="color: #008000;">大小</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> newfd; </span><span style="color: #008000;">/*</span><span style="color: #008000;">文件描述符</span><span style="color: #008000;">*/</span><span style="color: #000000;">    </span><span style="color: #008000;">/*</span><span style="color: #008000;">方便操作msg的结构</span><span style="color: #008000;">*/</span><span style="color: #000000;">  <br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    union{    <br></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> cmsghdr cm; </span><span style="color: #008000;">/*</span><span style="color: #008000;">control msg结构</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">        </span><span style="color: #0000ff;">char</span><span style="color: #000000;"> control[CMSG_SPACE(</span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">))]; </span><span style="color: #008000;">/*</span><span style="color: #008000;">字符指针，方便控制</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">10</span> <span style="color: #000000;">    }control_un;    <br></span><span style="color: #008080;">11</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> cmsghdr</span><span style="color: #000000;">*</span><span style="color: #000000;">pcmsghdr</span><span style="color: #000000;">=</span><span style="color: #000000;">NULL; </span><span style="color: #008000;">/*</span><span style="color: #008000;">控制头部的指针</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">12</span> <span style="color: #000000;">    msghdr_send.msg_control </span><span style="color: #000000;">=</span><span style="color: #000000;"> control_un.control; </span><span style="color: #008000;">/*</span><span style="color: #008000;">控制消息</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">13</span> <span style="color: #000000;">    msghdr_send.msg_controllen </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(control_un.control); </span><span style="color: #008000;">/*</span><span style="color: #008000;">长度</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">14</span> <span style="color: #000000;">    pcmsghdr </span><span style="color: #000000;">=</span><span style="color: #000000;"> CMSG_FIRSTHDR(</span><span style="color: #000000;">&amp;</span><span style="color: #000000;">msghdr_send); </span><span style="color: #008000;">/*</span><span style="color: #008000;">取得第一个消息头</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">15</span> <span style="color: #000000;">    pcmsghdr</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">cmsg_len </span><span style="color: #000000;">=</span><span style="color: #000000;"> CMSG_LEN(</span><span style="color: #0000ff;">sizeof</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span><span style="color: #000000;">)); </span><span style="color: #008000;">/*</span><span style="color: #008000;">获得长度</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    pcmsghdr</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">cmsg_level </span><span style="color: #000000;">=</span><span style="color: #000000;"> SOL_SOCKET; </span><span style="color: #008000;">/*</span><span style="color: #008000;">用于控制消息</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">17</span> <span style="color: #000000;">    pcmsghdr</span><span style="color: #000000;">-&gt;</span><span style="color: #000000;">cmsg_type </span><span style="color: #000000;">=</span><span style="color: #000000;"> SCM_RIGHTS;    <br></span><span style="color: #008080;">18</span> <span style="color: #000000;">    </span><span style="color: #000000;">*</span><span style="color: #000000;">((</span><span style="color: #0000ff;">int</span><span style="color: #000000;">*</span><span style="color: #000000;">)CMSG_DATA(pcmsghdr))</span><span style="color: #000000;">=</span><span style="color: #000000;"> sendfd; </span><span style="color: #008000;">/*</span><span style="color: #008000;">socket值</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    msghdr_send.msg_name </span><span style="color: #000000;">=</span><span style="color: #000000;"> NULL; </span><span style="color: #008000;">/*</span><span style="color: #008000;">名称</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">20</span> <span style="color: #000000;">    msghdr_send.msg_namelen </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; </span><span style="color: #008000;">/*</span><span style="color: #008000;">名称长度</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">21</span> <span style="color: #000000;">    iov[</span><span style="color: #800080;">0</span><span style="color: #000000;">].iov_base </span><span style="color: #000000;">=</span><span style="color: #000000;"> data; </span><span style="color: #008000;">/*</span><span style="color: #008000;">向量指针</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">22</span> <span style="color: #000000;">    iov[</span><span style="color: #800080;">0</span><span style="color: #000000;">].iov_len </span><span style="color: #000000;">=</span><span style="color: #000000;"> bytes; </span><span style="color: #008000;">/*</span><span style="color: #008000;">数据长度</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">23</span> <span style="color: #000000;">    msghdr_send.msg_iov </span><span style="color: #000000;">=</span><span style="color: #000000;"> iov; </span><span style="color: #008000;">/*</span><span style="color: #008000;">填充消息</span><span style="color: #008000;">*/</span><span style="color: #000000;">    <br></span><span style="color: #008080;">24</span> <span style="color: #000000;">    msghdr_send.msg_iovlen </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;    <br></span><span style="color: #008080;">25</span> <span style="color: #000000;">    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (sendmsg(fd, </span><span style="color: #000000;">&amp;</span><span style="color: #000000;">msghdr_send, </span><span style="color: #800080;">0</span><span style="color: #000000;">)); </span><span style="color: #008000;">/*</span><span style="color: #008000;">发送消息</span><span style="color: #008000;">*/</span><span style="color: #000000;"><br></span><span style="color: #008080;">26</span> <span style="color: #000000;">}</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./09_files/copycode.gif" alt="复制代码"></a></span></div></div>
</div>
<p>&nbsp;</p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><strong><span style="font-family: 宋体; font-size: 24pt; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">代码：</span></strong></p>
<div class="cnblogs_Highlighter">
<div><div id="highlighter_767415" class="syntaxhighlighter   cpp"><div class="toolbar"><span><a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180658.html#" class="toolbar_item command_expandSource expandSource">View Code</a></span><span><a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180658.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div><div class="line number102 index101 alt1">102</div><div class="line number103 index102 alt2">103</div><div class="line number104 index103 alt1">104</div><div class="line number105 index104 alt2">105</div><div class="line number106 index105 alt1">106</div><div class="line number107 index106 alt2">107</div><div class="line number108 index107 alt1">108</div><div class="line number109 index108 alt2">109</div><div class="line number110 index109 alt1">110</div><div class="line number111 index110 alt2">111</div><div class="line number112 index111 alt1">112</div><div class="line number113 index112 alt2">113</div><div class="line number114 index113 alt1">114</div><div class="line number115 index114 alt2">115</div><div class="line number116 index115 alt1">116</div><div class="line number117 index116 alt2">117</div><div class="line number118 index117 alt1">118</div><div class="line number119 index118 alt2">119</div><div class="line number120 index119 alt1">120</div><div class="line number121 index120 alt2">121</div><div class="line number122 index121 alt1">122</div><div class="line number123 index122 alt2">123</div><div class="line number124 index123 alt1">124</div><div class="line number125 index124 alt2">125</div><div class="line number126 index125 alt1">126</div><div class="line number127 index126 alt2">127</div><div class="line number128 index127 alt1">128</div><div class="line number129 index128 alt2">129</div><div class="line number130 index129 alt1">130</div><div class="line number131 index130 alt2">131</div><div class="line number132 index131 alt1">132</div><div class="line number133 index132 alt2">133</div><div class="line number134 index133 alt1">134</div><div class="line number135 index134 alt2">135</div><div class="line number136 index135 alt1">136</div><div class="line number137 index136 alt2">137</div><div class="line number138 index137 alt1">138</div><div class="line number139 index138 alt2">139</div><div class="line number140 index139 alt1">140</div><div class="line number141 index140 alt2">141</div><div class="line number142 index141 alt1">142</div><div class="line number143 index142 alt2">143</div><div class="line number144 index143 alt1">144</div><div class="line number145 index144 alt2">145</div><div class="line number146 index145 alt1">146</div><div class="line number147 index146 alt2">147</div><div class="line number148 index147 alt1">148</div><div class="line number149 index148 alt2">149</div><div class="line number150 index149 alt1">150</div><div class="line number151 index150 alt2">151</div><div class="line number152 index151 alt1">152</div><div class="line number153 index152 alt2">153</div><div class="line number154 index153 alt1">154</div><div class="line number155 index154 alt2">155</div><div class="line number156 index155 alt1">156</div><div class="line number157 index156 alt2">157</div><div class="line number158 index157 alt1">158</div><div class="line number159 index158 alt2">159</div><div class="line number160 index159 alt1">160</div><div class="line number161 index160 alt2">161</div><div class="line number162 index161 alt1">162</div><div class="line number163 index162 alt2">163</div><div class="line number164 index163 alt1">164</div><div class="line number165 index164 alt2">165</div><div class="line number166 index165 alt1">166</div><div class="line number167 index166 alt2">167</div><div class="line number168 index167 alt1">168</div><div class="line number169 index168 alt2">169</div><div class="line number170 index169 alt1">170</div><div class="line number171 index170 alt2">171</div><div class="line number172 index171 alt1">172</div><div class="line number173 index172 alt2">173</div><div class="line number174 index173 alt1">174</div><div class="line number175 index174 alt2">175</div><div class="line number176 index175 alt1">176</div><div class="line number177 index176 alt2">177</div><div class="line number178 index177 alt1">178</div><div class="line number179 index178 alt2">179</div><div class="line number180 index179 alt1">180</div><div class="line number181 index180 alt2">181</div><div class="line number182 index181 alt1">182</div><div class="line number183 index182 alt2">183</div><div class="line number184 index183 alt1">184</div><div class="line number185 index184 alt2">185</div><div class="line number186 index185 alt1">186</div><div class="line number187 index186 alt2">187</div><div class="line number188 index187 alt1">188</div><div class="line number189 index188 alt2">189</div><div class="line number190 index189 alt1">190</div><div class="line number191 index190 alt2">191</div><div class="line number192 index191 alt1">192</div><div class="line number193 index192 alt2">193</div><div class="line number194 index193 alt1">194</div><div class="line number195 index194 alt2">195</div><div class="line number196 index195 alt1">196</div><div class="line number197 index196 alt2">197</div><div class="line number198 index197 alt1">198</div><div class="line number199 index198 alt2">199</div><div class="line number200 index199 alt1">200</div><div class="line number201 index200 alt2">201</div><div class="line number202 index201 alt1">202</div><div class="line number203 index202 alt2">203</div><div class="line number204 index203 alt1">204</div><div class="line number205 index204 alt2">205</div><div class="line number206 index205 alt1">206</div><div class="line number207 index206 alt2">207</div><div class="line number208 index207 alt1">208</div><div class="line number209 index208 alt2">209</div><div class="line number210 index209 alt1">210</div><div class="line number211 index210 alt2">211</div><div class="line number212 index211 alt1">212</div><div class="line number213 index212 alt2">213</div><div class="line number214 index213 alt1">214</div><div class="line number215 index214 alt2">215</div><div class="line number216 index215 alt1">216</div><div class="line number217 index216 alt2">217</div><div class="line number218 index217 alt1">218</div><div class="line number219 index218 alt2">219</div><div class="line number220 index219 alt1">220</div><div class="line number221 index220 alt2">221</div><div class="line number222 index221 alt1">222</div><div class="line number223 index222 alt2">223</div><div class="line number224 index223 alt1">224</div><div class="line number225 index224 alt2">225</div><div class="line number226 index225 alt1">226</div><div class="line number227 index226 alt2">227</div><div class="line number228 index227 alt1">228</div><div class="line number229 index228 alt2">229</div><div class="line number230 index229 alt1">230</div><div class="line number231 index230 alt2">231</div><div class="line number232 index231 alt1">232</div><div class="line number233 index232 alt2">233</div><div class="line number234 index233 alt1">234</div><div class="line number235 index234 alt2">235</div><div class="line number236 index235 alt1">236</div><div class="line number237 index236 alt2">237</div><div class="line number238 index237 alt1">238</div><div class="line number239 index238 alt2">239</div><div class="line number240 index239 alt1">240</div><div class="line number241 index240 alt2">241</div><div class="line number242 index241 alt1">242</div><div class="line number243 index242 alt2">243</div><div class="line number244 index243 alt1">244</div><div class="line number245 index244 alt2">245</div><div class="line number246 index245 alt1">246</div><div class="line number247 index246 alt2">247</div><div class="line number248 index247 alt1">248</div><div class="line number249 index248 alt2">249</div><div class="line number250 index249 alt1">250</div><div class="line number251 index250 alt2">251</div><div class="line number252 index251 alt1">252</div><div class="line number253 index252 alt2">253</div><div class="line number254 index253 alt1">254</div><div class="line number255 index254 alt2">255</div><div class="line number256 index255 alt1">256</div><div class="line number257 index256 alt2">257</div><div class="line number258 index257 alt1">258</div><div class="line number259 index258 alt2">259</div><div class="line number260 index259 alt1">260</div><div class="line number261 index260 alt2">261</div><div class="line number262 index261 alt1">262</div><div class="line number263 index262 alt2">263</div><div class="line number264 index263 alt1">264</div><div class="line number265 index264 alt2">265</div><div class="line number266 index265 alt1">266</div><div class="line number267 index266 alt2">267</div><div class="line number268 index267 alt1">268</div><div class="line number269 index268 alt2">269</div><div class="line number270 index269 alt1">270</div><div class="line number271 index270 alt2">271</div><div class="line number272 index271 alt1">272</div><div class="line number273 index272 alt2">273</div><div class="line number274 index273 alt1">274</div><div class="line number275 index274 alt2">275</div><div class="line number276 index275 alt1">276</div><div class="line number277 index276 alt2">277</div><div class="line number278 index277 alt1">278</div><div class="line number279 index278 alt2">279</div><div class="line number280 index279 alt1">280</div><div class="line number281 index280 alt2">281</div><div class="line number282 index281 alt1">282</div><div class="line number283 index282 alt2">283</div><div class="line number284 index283 alt1">284</div><div class="line number285 index284 alt2">285</div><div class="line number286 index285 alt1">286</div><div class="line number287 index286 alt2">287</div><div class="line number288 index287 alt1">288</div><div class="line number289 index288 alt2">289</div><div class="line number290 index289 alt1">290</div><div class="line number291 index290 alt2">291</div><div class="line number292 index291 alt1">292</div><div class="line number293 index292 alt2">293</div><div class="line number294 index293 alt1">294</div><div class="line number295 index294 alt2">295</div><div class="line number296 index295 alt1">296</div><div class="line number297 index296 alt2">297</div><div class="line number298 index297 alt1">298</div><div class="line number299 index298 alt2">299</div><div class="line number300 index299 alt1">300</div><div class="line number301 index300 alt2">301</div><div class="line number302 index301 alt1">302</div><div class="line number303 index302 alt2">303</div><div class="line number304 index303 alt1">304</div><div class="line number305 index304 alt2">305</div><div class="line number306 index305 alt1">306</div><div class="line number307 index306 alt2">307</div><div class="line number308 index307 alt1">308</div><div class="line number309 index308 alt2">309</div><div class="line number310 index309 alt1">310</div><div class="line number311 index310 alt2">311</div><div class="line number312 index311 alt1">312</div><div class="line number313 index312 alt2">313</div><div class="line number314 index313 alt1">314</div><div class="line number315 index314 alt2">315</div><div class="line number316 index315 alt1">316</div><div class="line number317 index316 alt2">317</div><div class="line number318 index317 alt1">318</div><div class="line number319 index318 alt2">319</div><div class="line number320 index319 alt1">320</div><div class="line number321 index320 alt2">321</div><div class="line number322 index321 alt1">322</div><div class="line number323 index322 alt2">323</div><div class="line number324 index323 alt1">324</div><div class="line number325 index324 alt2">325</div><div class="line number326 index325 alt1">326</div><div class="line number327 index326 alt2">327</div><div class="line number328 index327 alt1">328</div><div class="line number329 index328 alt2">329</div><div class="line number330 index329 alt1">330</div><div class="line number331 index330 alt2">331</div><div class="line number332 index331 alt1">332</div><div class="line number333 index332 alt2">333</div><div class="line number334 index333 alt1">334</div><div class="line number335 index334 alt2">335</div><div class="line number336 index335 alt1">336</div><div class="line number337 index336 alt2">337</div><div class="line number338 index337 alt1">338</div><div class="line number339 index338 alt2">339</div><div class="line number340 index339 alt1">340</div><div class="line number341 index340 alt2">341</div><div class="line number342 index341 alt1">342</div><div class="line number343 index342 alt2">343</div><div class="line number344 index343 alt1">344</div><div class="line number345 index344 alt2">345</div><div class="line number346 index345 alt1">346</div><div class="line number347 index346 alt2">347</div><div class="line number348 index347 alt1">348</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp preprocessor">#include&lt;sys/types.h&gt;</code></div><div class="line number2 index1 alt1"><code class="cpp preprocessor">#include&lt;sys/socket.h&gt;</code></div><div class="line number3 index2 alt2"><code class="cpp preprocessor">#include&lt;strings.h&gt;</code></div><div class="line number4 index3 alt1"><code class="cpp preprocessor">#include&lt;arpa/inet.h&gt;</code></div><div class="line number5 index4 alt2"><code class="cpp preprocessor">#include&lt;unistd.h&gt;</code></div><div class="line number6 index5 alt1"><code class="cpp preprocessor">#include&lt;stdlib.h&gt;</code></div><div class="line number7 index6 alt2"><code class="cpp preprocessor">#include&lt;stdio.h&gt;</code></div><div class="line number8 index7 alt1"><code class="cpp preprocessor">#include&lt;string.h&gt;</code></div><div class="line number9 index8 alt2"><code class="cpp preprocessor">#include&lt;errno.h&gt;</code></div><div class="line number10 index9 alt1"><code class="cpp preprocessor">#include&lt;signal.h&gt;</code></div><div class="line number11 index10 alt2"><code class="cpp preprocessor">#include&lt;sys/wait.h&gt;</code></div><div class="line number12 index11 alt1"><code class="cpp preprocessor">#include&lt;sys/time.h&gt;</code></div><div class="line number13 index12 alt2"><code class="cpp preprocessor">#include&lt;pthread.h&gt;</code></div><div class="line number14 index13 alt1"><code class="cpp preprocessor">#include&lt;algorithm&gt;</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="cpp preprocessor">#include&lt;sys/stat.h&gt;</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="cpp preprocessor">#define LISTEN_PORT 84</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="cpp comments">///////////////////</code></div><div class="line number22 index21 alt1"><code class="cpp color1 bold">size_t</code> <code class="cpp plain">recv_fd(</code><code class="cpp color1 bold">int</code> <code class="cpp plain">fd, </code><code class="cpp keyword bold">void</code><code class="cpp plain">*data, </code><code class="cpp color1 bold">size_t</code> <code class="cpp plain">bytes, </code><code class="cpp color1 bold">int</code><code class="cpp plain">*recvfd)</code></div><div class="line number23 index22 alt2"><code class="cpp plain">{&nbsp; </code></div><div class="line number24 index23 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">msghdr msghdr_recv; </code><code class="cpp comments">/*接收消息接收*/</code>&nbsp;</div><div class="line number25 index24 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">iovec iov[1]; </code><code class="cpp comments">/*接收数据的向量*/</code>&nbsp;</div><div class="line number26 index25 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">size_t</code> <code class="cpp plain">n;&nbsp; </code></div><div class="line number27 index26 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">newfd; </code></div><div class="line number28 index27 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">union</code><code class="cpp plain">{&nbsp;&nbsp; </code></div><div class="line number29 index28 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">cmsghdr cm;</code></div><div class="line number30 index29 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">char</code> <code class="cpp plain">control[CMSG_SPACE(</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(</code><code class="cpp color1 bold">int</code><code class="cpp plain">))]; </code></div><div class="line number31 index30 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}control_un; </code></div><div class="line number32 index31 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">cmsghdr*pcmsghdr; </code><code class="cpp comments">/*消息头部*/</code>&nbsp;</div><div class="line number33 index32 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_recv.msg_control = control_un.control; </code><code class="cpp comments">/*控制消息*/</code>&nbsp;</div><div class="line number34 index33 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_recv.msg_controllen = </code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(control_un.control); </code><code class="cpp comments">/*控制消息的长度*/</code>&nbsp;</div><div class="line number35 index34 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_recv.msg_name = NULL; </code><code class="cpp comments">/*消息的名称为空*/</code>&nbsp;</div><div class="line number36 index35 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_recv.msg_namelen = 0; </code><code class="cpp comments">/*消息的长度为空*/</code>&nbsp;</div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">iov[0].iov_base = data; </code><code class="cpp comments">/*向量的数据为传入的数据*/</code>&nbsp;</div><div class="line number39 index38 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">iov[0].iov_len = bytes; </code><code class="cpp comments">/*向量的长度为传入数据的长度*/</code>&nbsp;</div><div class="line number40 index39 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_recv.msg_iov = iov; </code><code class="cpp comments">/*消息向量指针*/</code>&nbsp;</div><div class="line number41 index40 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_recv.msg_iovlen = 1; </code><code class="cpp comments">/*消息向量的个数为1个*/</code>&nbsp;</div><div class="line number42 index41 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">((n = recvmsg(fd, &amp;msghdr_recv, 0))&lt;=0) </code><code class="cpp comments">/*接收消息*/</code>&nbsp;&nbsp;</div><div class="line number43 index42 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">n;&nbsp; </code></div><div class="line number44 index43 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">((pcmsghdr = CMSG_FIRSTHDR(&amp;msghdr_recv))!= NULL &amp;&amp; </code><code class="cpp comments">/*获得消息的头部*/</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="line number45 index44 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pcmsghdr-&gt;cmsg_len == CMSG_LEN(</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(</code><code class="cpp color1 bold">int</code><code class="cpp plain">))) { </code><code class="cpp comments">/*获得消息的长度为int*/</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="line number46 index45 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(pcmsghdr-&gt;cmsg_level != SOL_SOCKET) </code><code class="cpp comments">/*消息的level应该为SOL_SOCKET*/</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"control level != SOL_SOCKET\n"</code><code class="cpp plain">);&nbsp;&nbsp;&nbsp; </code></div><div class="line number47 index46 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(pcmsghdr-&gt;cmsg_type != SCM_RIGHTS) </code><code class="cpp comments">/*消息的类型判断*/</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="line number48 index47 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"control type != SCM_RIGHTS\n"</code><code class="cpp plain">);&nbsp;&nbsp;&nbsp; </code></div><div class="line number49 index48 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">*recvfd =*((</code><code class="cpp color1 bold">int</code><code class="cpp plain">*)CMSG_DATA(pcmsghdr)); </code><code class="cpp comments">/*获得打开文件的描述符*/</code>&nbsp;</div><div class="line number50 index49 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">} </code><code class="cpp keyword bold">else</code>&nbsp;&nbsp;&nbsp;</div><div class="line number51 index50 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">*recvfd = -1;&nbsp; </code></div><div class="line number52 index51 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">n; </code><code class="cpp comments">/*返回接收消息的长度*/</code></div><div class="line number53 index52 alt2"><code class="cpp plain">}</code></div><div class="line number54 index53 alt1">&nbsp;</div><div class="line number55 index54 alt2"><code class="cpp plain">ssize_t send_fd(</code><code class="cpp color1 bold">int</code> <code class="cpp plain">fd, </code><code class="cpp keyword bold">void</code><code class="cpp plain">*data, </code><code class="cpp color1 bold">size_t</code> <code class="cpp plain">bytes, </code><code class="cpp color1 bold">int</code> <code class="cpp plain">sendfd)</code></div><div class="line number56 index55 alt1"><code class="cpp plain">{&nbsp; </code></div><div class="line number57 index56 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">msghdr msghdr_send; </code><code class="cpp comments">/*发送消息*/</code>&nbsp;</div><div class="line number58 index57 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">iovec iov[1]; </code><code class="cpp comments">/*向量*/</code>&nbsp;</div><div class="line number59 index58 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">size_t</code> <code class="cpp plain">n; </code><code class="cpp comments">/*大小*/</code>&nbsp;</div><div class="line number60 index59 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">newfd; </code><code class="cpp comments">/*文件描述符*/</code>&nbsp;&nbsp;&nbsp; <code class="cpp comments">/*方便操作msg的结构*/</code>&nbsp;</div><div class="line number61 index60 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">union</code><code class="cpp plain">{&nbsp;&nbsp;&nbsp; </code></div><div class="line number62 index61 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">cmsghdr cm; </code><code class="cpp comments">/*control msg结构*/</code>&nbsp;&nbsp;&nbsp;</div><div class="line number63 index62 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">char</code> <code class="cpp plain">control[CMSG_SPACE(</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(</code><code class="cpp color1 bold">int</code><code class="cpp plain">))]; </code><code class="cpp comments">/*字符指针，方便控制*/</code>&nbsp;&nbsp;&nbsp;</div><div class="line number64 index63 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}control_un;&nbsp;&nbsp;&nbsp; </code></div><div class="line number65 index64 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">cmsghdr*pcmsghdr=NULL; </code><code class="cpp comments">/*控制头部的指针*/</code>&nbsp;&nbsp;</div><div class="line number66 index65 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_send.msg_control = control_un.control; </code><code class="cpp comments">/*控制消息*/</code>&nbsp;</div><div class="line number67 index66 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_send.msg_controllen = </code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(control_un.control); </code><code class="cpp comments">/*长度*/</code></div><div class="line number68 index67 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pcmsghdr = CMSG_FIRSTHDR(&amp;msghdr_send); </code><code class="cpp comments">/*取得第一个消息头*/</code>&nbsp;&nbsp;&nbsp;</div><div class="line number69 index68 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pcmsghdr-&gt;cmsg_len = CMSG_LEN(</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(</code><code class="cpp color1 bold">int</code><code class="cpp plain">)); </code><code class="cpp comments">/*获得长度*/</code></div><div class="line number70 index69 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pcmsghdr-&gt;cmsg_level = SOL_SOCKET; </code><code class="cpp comments">/*用于控制消息*/</code>&nbsp;&nbsp;&nbsp;</div><div class="line number71 index70 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pcmsghdr-&gt;cmsg_type = SCM_RIGHTS;&nbsp;&nbsp;&nbsp; </code></div><div class="line number72 index71 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">*((</code><code class="cpp color1 bold">int</code><code class="cpp plain">*)CMSG_DATA(pcmsghdr))= sendfd; </code><code class="cpp comments">/*socket值*/</code>&nbsp;&nbsp;</div><div class="line number73 index72 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_send.msg_name = NULL; </code><code class="cpp comments">/*名称*/</code></div><div class="line number74 index73 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_send.msg_namelen = 0; </code><code class="cpp comments">/*名称长度*/</code>&nbsp;&nbsp;</div><div class="line number75 index74 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">iov[0].iov_base = data; </code><code class="cpp comments">/*向量指针*/</code>&nbsp;&nbsp;&nbsp;</div><div class="line number76 index75 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">iov[0].iov_len = bytes; </code><code class="cpp comments">/*数据长度*/</code>&nbsp;&nbsp;&nbsp;</div><div class="line number77 index76 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_send.msg_iov = iov; </code><code class="cpp comments">/*填充消息*/</code></div><div class="line number78 index77 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">msghdr_send.msg_iovlen = 1; </code></div><div class="line number79 index78 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">(sendmsg(fd, &amp;msghdr_send, 0)); </code><code class="cpp comments">/*发送消息*/</code></div><div class="line number80 index79 alt1"><code class="cpp plain">}</code></div><div class="line number81 index80 alt2">&nbsp;</div><div class="line number82 index81 alt1"><code class="cpp comments">///////////////////</code></div><div class="line number83 index82 alt2"><code class="cpp comments">//服务器处理</code></div><div class="line number84 index83 alt1"><code class="cpp keyword bold">void</code> <code class="cpp plain">str_echo(</code><code class="cpp color1 bold">int</code> <code class="cpp plain">sockfd)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="cpp comments">// 服务器收到客户端的消息后的响应</code></div><div class="line number85 index84 alt2"><code class="cpp plain">{</code></div><div class="line number86 index85 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">ssize_t n;</code></div><div class="line number87 index86 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">char</code> <code class="cpp plain">line[512];</code></div><div class="line number88 index87 alt1">&nbsp;</div><div class="line number89 index88 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"ready to read\n"</code><code class="cpp plain">);</code></div><div class="line number90 index89 alt1">&nbsp;</div><div class="line number91 index90 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">while</code><code class="cpp plain">( (n=read(sockfd,line,512))&gt;0 )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="cpp comments">//阻塞IO版本</code></div><div class="line number92 index91 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number93 index92 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">line[n]=</code><code class="cpp string">'\0'</code><code class="cpp plain">;</code></div><div class="line number94 index93 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"Client : %s\n"</code><code class="cpp plain">,line);</code></div><div class="line number95 index94 alt2">&nbsp;</div><div class="line number96 index95 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">char</code> <code class="cpp plain">msgBack[512];</code></div><div class="line number97 index96 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">snprintf(msgBack,</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(msgBack),</code><code class="cpp string">"recv: %s\n"</code><code class="cpp plain">,line);</code></div><div class="line number98 index97 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">write(sockfd,msgBack,</code><code class="cpp functions bold">strlen</code><code class="cpp plain">(msgBack));</code></div><div class="line number99 index98 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">bzero(&amp;line,</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(line));</code></div><div class="line number100 index99 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number101 index100 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"end read\n"</code><code class="cpp plain">);</code></div><div class="line number102 index101 alt1"><code class="cpp plain">}</code></div><div class="line number103 index102 alt2">&nbsp;</div><div class="line number104 index103 alt1"><code class="cpp comments">//子进程结束的信号处理</code></div><div class="line number105 index104 alt2"><code class="cpp color1 bold">float</code> <code class="cpp plain">timeuse;</code></div><div class="line number106 index105 alt1"><code class="cpp keyword bold">void</code> <code class="cpp plain">sig_child(</code><code class="cpp color1 bold">int</code> <code class="cpp plain">signo)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="cpp comments">//父进程对子进程结束的信号处理</code></div><div class="line number107 index106 alt2"><code class="cpp plain">{</code></div><div class="line number108 index107 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pid_t pid;</code></div><div class="line number109 index108 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code>&nbsp;&nbsp; <code class="cpp plain">stat;</code></div><div class="line number110 index109 alt1">&nbsp;</div><div class="line number111 index110 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">timeval tpstart,tpend;</code></div><div class="line number112 index111 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//float timeuse;</code></div><div class="line number113 index112 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">gettimeofday(&amp;tpstart,NULL);</code></div><div class="line number114 index113 alt1">&nbsp;</div><div class="line number115 index114 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">while</code><code class="cpp plain">( (pid=waitpid(-1,&amp;stat,WNOHANG))&gt;0)</code></div><div class="line number116 index115 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"child %d terminated\n"</code><code class="cpp plain">,pid);</code></div><div class="line number117 index116 alt2">&nbsp;</div><div class="line number118 index117 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">gettimeofday(&amp;tpend,NULL);</code></div><div class="line number119 index118 alt2">&nbsp;</div><div class="line number120 index119 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">timeuse+=1000000*(tpend.tv_sec-tpstart.tv_sec)+tpend.tv_usec-tpstart.tv_usec;</code></div><div class="line number121 index120 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//timeuse/=1000000;</code></div><div class="line number122 index121 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"Use Time:%f\n"</code><code class="cpp plain">,timeuse/1000000);</code></div><div class="line number123 index122 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code><code class="cpp plain">;</code></div><div class="line number124 index123 alt1"><code class="cpp plain">}</code></div><div class="line number125 index124 alt2">&nbsp;</div><div class="line number126 index125 alt1">&nbsp;</div><div class="line number127 index126 alt2"><code class="cpp comments">/* prefork + select */</code></div><div class="line number128 index127 alt1"><code class="cpp keyword bold">typedef</code> <code class="cpp keyword bold">struct</code> <code class="cpp plain">{</code></div><div class="line number129 index128 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pid_t child_pid;</code></div><div class="line number130 index129 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">child_pipefd;</code></div><div class="line number131 index130 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">child_status;</code></div><div class="line number132 index131 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">long</code> <code class="cpp plain">child_count;</code></div><div class="line number133 index132 alt2"><code class="cpp plain">}Child;</code></div><div class="line number134 index133 alt1"><code class="cpp plain">Child *cptr;</code></div><div class="line number135 index134 alt2"><code class="cpp comments">//我们必须为每个进程维护一个信息结构来管理各子进程</code></div><div class="line number136 index135 alt1"><code class="cpp comments">//子进程ID，父子字节流管道描述字，子进程状态，子进程已处理客户数</code></div><div class="line number137 index136 alt2">&nbsp;</div><div class="line number138 index137 alt1"><code class="cpp plain">pid_t child_make(</code><code class="cpp color1 bold">int</code> <code class="cpp plain">i, </code><code class="cpp color1 bold">int</code> <code class="cpp plain">listenfd, </code><code class="cpp color1 bold">int</code> <code class="cpp plain">addrlen)</code></div><div class="line number139 index138 alt2"><code class="cpp plain">{</code></div><div class="line number140 index139 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">sockfd[2];</code></div><div class="line number141 index140 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pid_t pid;</code></div><div class="line number142 index141 alt1">&nbsp;</div><div class="line number143 index142 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">void</code> <code class="cpp plain">child_main(</code><code class="cpp color1 bold">int</code><code class="cpp plain">,</code><code class="cpp color1 bold">int</code><code class="cpp plain">,</code><code class="cpp color1 bold">int</code><code class="cpp plain">);</code></div><div class="line number144 index143 alt1">&nbsp;</div><div class="line number145 index144 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">socketpair(AF_LOCAL,SOCK_STREAM,0,sockfd);</code></div><div class="line number146 index145 alt1">&nbsp;</div><div class="line number147 index146 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">( (pid=fork())&gt;0)</code></div><div class="line number148 index147 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number149 index148 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">close(sockfd[1]);</code></div><div class="line number150 index149 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">cptr[i].child_pid=pid;</code></div><div class="line number151 index150 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">cptr[i].child_pipefd=sockfd[0];</code></div><div class="line number152 index151 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">cptr[i].child_status=0;</code></div><div class="line number153 index152 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">pid;</code></div><div class="line number154 index153 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number155 index154 alt2">&nbsp;</div><div class="line number156 index155 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">dup2(sockfd[1],STDERR_FILENO);</code></div><div class="line number157 index156 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">close(sockfd[0]);</code></div><div class="line number158 index157 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">close(sockfd[1]);</code></div><div class="line number159 index158 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">close(listenfd);</code></div><div class="line number160 index159 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">child_main(i,listenfd,addrlen);</code></div><div class="line number161 index160 alt2"><code class="cpp plain">}</code></div><div class="line number162 index161 alt1"><code class="cpp comments">//在使用fork创建子进程之前，先创建一个字节流管道（Unix域），随后利用管道通信</code></div><div class="line number163 index162 alt2">&nbsp;</div><div class="line number164 index163 alt1"><code class="cpp keyword bold">void</code> <code class="cpp plain">child_main(</code><code class="cpp color1 bold">int</code> <code class="cpp plain">i, </code><code class="cpp color1 bold">int</code> <code class="cpp plain">listenfd ,</code><code class="cpp color1 bold">int</code> <code class="cpp plain">addrlen)</code></div><div class="line number165 index164 alt2"><code class="cpp plain">{</code></div><div class="line number166 index165 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">char</code> <code class="cpp plain">c;</code></div><div class="line number167 index166 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">connfd;</code></div><div class="line number168 index167 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">ssize_t n;</code></div><div class="line number169 index168 alt2">&nbsp;</div><div class="line number170 index169 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"child %ld starting\n"</code><code class="cpp plain">,(</code><code class="cpp color1 bold">long</code><code class="cpp plain">)getpid());</code></div><div class="line number171 index170 alt2">&nbsp;</div><div class="line number172 index171 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">for</code><code class="cpp plain">(;;)</code></div><div class="line number173 index172 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number174 index173 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">((n=recv_fd(STDERR_FILENO,&amp;c,1,&amp;connfd))==0)</code></div><div class="line number175 index174 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number176 index175 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//FILE* newFile=new FILE();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //传递整个FILE结构也可以</code></div><div class="line number177 index176 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//if((n=read(STDERR_FILENO,newFile,sizeof(FILE)))==0)</code></div><div class="line number178 index177 alt1">&nbsp;</div><div class="line number179 index178 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//不能直接接收新连接的fd，因为这时候子进程fork出来时并没有所谓的进程fd表</code></div><div class="line number180 index179 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//如果直接访问某个fd那会失败！！所以需要Unix域通信</code></div><div class="line number181 index180 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number182 index181 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{ </code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"read_fd returned 0\n"</code><code class="cpp plain">);</code><code class="cpp keyword bold">return</code> <code class="cpp plain">;}</code></div><div class="line number183 index182 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//else printf("connfd is %d\n",connfd);</code></div><div class="line number184 index183 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">else</code> <code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"read success\n"</code><code class="cpp plain">);</code></div><div class="line number185 index184 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number186 index185 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//connfd=fileno(newFile);</code></div><div class="line number187 index186 alt2">&nbsp;</div><div class="line number188 index187 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(connfd&lt;0)</code></div><div class="line number189 index188 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{&nbsp;&nbsp; </code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"no descriptor form read_fd\n"</code><code class="cpp plain">);</code><code class="cpp keyword bold">return</code> <code class="cpp plain">;}</code></div><div class="line number190 index189 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">else</code> <code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"fd is %d\n"</code><code class="cpp plain">,connfd);</code></div><div class="line number191 index190 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number192 index191 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">str_echo(connfd);</code></div><div class="line number193 index192 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number194 index193 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">close(connfd);</code></div><div class="line number195 index194 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number196 index195 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">write(STDERR_FILENO,</code><code class="cpp string">"\n"</code><code class="cpp plain">,1);</code></div><div class="line number197 index196 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number198 index197 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//子进程初始化后，阻塞等待父进程接收到连接的socket后发过来</code></div><div class="line number199 index198 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//发过来后，就开始在这个socket上等待，处理</code></div><div class="line number200 index199 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//处理完成后，再写到管道，这时候父进程select的是各个子进程的管道</code></div><div class="line number201 index200 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//一旦select到了，就表示子进程处理好了，就可以设置子进程为空闲</code></div><div class="line number202 index201 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//下一个connect又可以给这个子进程来处理了。</code></div><div class="line number203 index202 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//父子进程间，主要是通过read，write来写消息来完成控制！</code></div><div class="line number204 index203 alt1">&nbsp;</div><div class="line number205 index204 alt2"><code class="cpp plain">}</code></div><div class="line number206 index205 alt1"><code class="cpp comments">//处理完客户请求后，通过字节流管道向父进程发回单个字节，通知父亲标识它为可用。</code></div><div class="line number207 index206 alt2"><code class="cpp comments">//如果意外终止，字节流管道所在端会关闭，read返回0，父进程捕获。</code></div><div class="line number208 index207 alt1">&nbsp;</div><div class="line number209 index208 alt2"><code class="cpp comments">/* prefork + select */</code></div><div class="line number210 index209 alt1"><code class="cpp keyword bold">static</code> <code class="cpp color1 bold">int</code> <code class="cpp plain">nchildren;</code></div><div class="line number211 index210 alt2">&nbsp;</div><div class="line number212 index211 alt1"><code class="cpp color1 bold">int</code> <code class="cpp plain">main(</code><code class="cpp color1 bold">int</code> <code class="cpp plain">argc, </code><code class="cpp color1 bold">char</code> <code class="cpp plain">**argv)</code></div><div class="line number213 index212 alt2"><code class="cpp plain">{</code></div><div class="line number214 index213 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">listenfd, connfd;</code></div><div class="line number215 index214 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pid_t childpid;</code></div><div class="line number216 index215 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">socklen_t chilen;</code></div><div class="line number217 index216 alt2">&nbsp;</div><div class="line number218 index217 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">sockaddr_in chiaddr,servaddr;</code></div><div class="line number219 index218 alt2">&nbsp;</div><div class="line number220 index219 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//for select</code></div><div class="line number221 index220 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">i,maxi,maxfd,sockfd;</code></div><div class="line number222 index221 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">nready,client[FD_SETSIZE];</code></div><div class="line number223 index222 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">ssize_t n;</code></div><div class="line number224 index223 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">fd_set rset,allset;</code></div><div class="line number225 index224 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//for select</code></div><div class="line number226 index225 alt1">&nbsp;</div><div class="line number227 index226 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">listenfd=socket(AF_INET,SOCK_STREAM,0);</code></div><div class="line number228 index227 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(listenfd==-1)</code></div><div class="line number229 index228 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number230 index229 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"socket established error: %s\n"</code><code class="cpp plain">,(</code><code class="cpp color1 bold">char</code><code class="cpp plain">*)</code><code class="cpp functions bold">strerror</code><code class="cpp plain">(</code><code class="cpp functions bold">errno</code><code class="cpp plain">));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number231 index230 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number232 index231 alt1">&nbsp;</div><div class="line number233 index232 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">bzero(&amp;servaddr,</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(servaddr));</code></div><div class="line number234 index233 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">servaddr.sin_family=AF_INET;</code></div><div class="line number235 index234 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">servaddr.sin_addr.s_addr=htonl(INADDR_ANY);</code></div><div class="line number236 index235 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">servaddr.sin_port=htons(LISTEN_PORT);</code></div><div class="line number237 index236 alt2">&nbsp;</div><div class="line number238 index237 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">bindc=bind(listenfd,(</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">sockaddr *)&amp;servaddr,</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(servaddr));</code></div><div class="line number239 index238 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(bindc==-1)</code></div><div class="line number240 index239 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number241 index240 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"bind error: %s\n"</code><code class="cpp plain">,</code><code class="cpp functions bold">strerror</code><code class="cpp plain">(</code><code class="cpp functions bold">errno</code><code class="cpp plain">));</code></div><div class="line number242 index241 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number243 index242 alt2">&nbsp;</div><div class="line number244 index243 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">listen(listenfd,SOMAXCONN);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="cpp comments">//limit是SOMAXCONN</code></div><div class="line number245 index244 alt2">&nbsp;</div><div class="line number246 index245 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//for server 0.5</code></div><div class="line number247 index246 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">navail,nset,rc;</code></div><div class="line number248 index247 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">socklen_t addrlen;</code></div><div class="line number249 index248 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//cliaddr</code></div><div class="line number250 index249 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//for server 0.5</code></div><div class="line number251 index250 alt2">&nbsp;</div><div class="line number252 index251 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//initial "select" elements</code></div><div class="line number253 index252 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">maxfd=listenfd;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="cpp comments">//新增listenfd，所以更新当前的最大fd</code></div><div class="line number254 index253 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">maxi=-1;</code></div><div class="line number255 index254 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">for</code><code class="cpp plain">(i=0;i&lt;FD_SETSIZE;i++)</code></div><div class="line number256 index255 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">client[i] = -1;</code></div><div class="line number257 index256 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">FD_ZERO(&amp;allset);</code></div><div class="line number258 index257 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">FD_SET(listenfd,&amp;allset);&nbsp;&nbsp; </code></div><div class="line number259 index258 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//end initial</code></div><div class="line number260 index259 alt1">&nbsp;</div><div class="line number261 index260 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//initial "server 0.5" element</code></div><div class="line number262 index261 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">nchildren=10;&nbsp;&nbsp; </code><code class="cpp comments">//假设接收10个</code></div><div class="line number263 index262 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">navail=nchildren;</code></div><div class="line number264 index263 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">cptr=(Child*)</code><code class="cpp functions bold">calloc</code><code class="cpp plain">(nchildren,</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(Child));</code></div><div class="line number265 index264 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">for</code><code class="cpp plain">(i=0;i&lt;nchildren;i++)</code></div><div class="line number266 index265 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number267 index266 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">child_make(i,listenfd,addrlen);&nbsp;&nbsp; </code></div><div class="line number268 index267 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//注意 这时候父进程还没有所谓的进程描述表项存在，没有所谓的文件打开描述结构</code></div><div class="line number269 index268 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">FD_SET(cptr[i].child_pipefd,&amp;allset);</code></div><div class="line number270 index269 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">maxfd=std::max(maxfd,cptr[i].child_pipefd);</code></div><div class="line number271 index270 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number272 index271 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//initial "server 0.5" element</code></div><div class="line number273 index272 alt2">&nbsp;</div><div class="line number274 index273 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">cliconn=0;</code></div><div class="line number275 index274 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">signal</code><code class="cpp plain">(SIGCHLD,sig_child);</code></div><div class="line number276 index275 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">for</code><code class="cpp plain">(;;)</code></div><div class="line number277 index276 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number278 index277 alt1">&nbsp;</div><div class="line number279 index278 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//for select</code></div><div class="line number280 index279 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">rset=allset;</code></div><div class="line number281 index280 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">( navail&lt;=0)</code></div><div class="line number282 index281 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">FD_CLR( listenfd,&amp;rset);</code></div><div class="line number283 index282 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//如果可用进程数为0，则将监听套接口从select描述字集中删除</code></div><div class="line number284 index283 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//没有可用子进程前不accept它们。</code></div><div class="line number285 index284 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">nready=select(maxfd+1,&amp;rset,NULL,NULL,NULL); </code><code class="cpp comments">//一开始select监听的是监听口</code></div><div class="line number286 index285 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//如果有timeout设置，那么每次select之前都要再重新设置一下timeout的值</code></div><div class="line number287 index286 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//因为select会修改timeout的值。</code></div><div class="line number288 index287 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number289 index288 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(FD_ISSET(listenfd,&amp;rset))</code></div><div class="line number290 index289 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number291 index290 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">chilen=</code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(chiaddr);</code></div><div class="line number292 index291 alt1">&nbsp;</div><div class="line number293 index292 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">connfd=accept(listenfd,(</code><code class="cpp keyword bold">struct</code> <code class="cpp plain">sockaddr*)&amp;chiaddr,&amp;chilen);</code></div><div class="line number294 index293 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//阻塞在accept，直到三次握手成功了才返回</code></div><div class="line number295 index294 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(connfd==-1)</code></div><div class="line number296 index295 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"accept client error: %s\n"</code><code class="cpp plain">,</code><code class="cpp functions bold">strerror</code><code class="cpp plain">(</code><code class="cpp functions bold">errno</code><code class="cpp plain">));</code></div><div class="line number297 index296 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">else</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="line number298 index297 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"client connected:%d\n"</code><code class="cpp plain">,++cliconn);</code></div><div class="line number299 index298 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// server 0.5</code></div><div class="line number300 index299 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">for</code><code class="cpp plain">(i=0;i&lt;nchildren;i++)</code></div><div class="line number301 index300 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(cptr[i].child_status==0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="cpp comments">//找出第一个可用子进程</code></div><div class="line number302 index301 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">break</code><code class="cpp plain">;</code></div><div class="line number303 index302 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(i==nchildren)</code></div><div class="line number304 index303 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{&nbsp;&nbsp; </code></div><div class="line number305 index304 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"no available children"</code><code class="cpp plain">);</code></div><div class="line number306 index305 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">0;</code></div><div class="line number307 index306 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">} </code></div><div class="line number308 index307 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">cptr[i].child_status=1;</code></div><div class="line number309 index308 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">cptr[i].child_count++;</code></div><div class="line number310 index309 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">navail--;</code></div><div class="line number311 index310 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number312 index311 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">n=send_fd( cptr[i].child_pipefd,(</code><code class="cpp keyword bold">void</code><code class="cpp plain">*)</code><code class="cpp string">""</code><code class="cpp plain">,1,connfd);</code></div><div class="line number313 index312 alt2">&nbsp;</div><div class="line number314 index313 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//n=write(cptr[i].child_pipefd,connFile,sizeof(FILE));</code></div><div class="line number315 index314 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//printf("%d--%d\n",n,sizeof(FILE));</code></div><div class="line number316 index315 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//n=write(cptr[i].child_pipefd,&amp;connfd,sizeof(connfd));</code></div><div class="line number317 index316 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//这时候不是说写个fd过去给孩子就可以，孩子根本就没有从父进程继承到这个记录</code></div><div class="line number318 index317 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//因为是之前fork出来的子进程</code></div><div class="line number319 index318 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number320 index319 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"n is %d,connfd is %d , child id is %d\n"</code><code class="cpp plain">,n, connfd,i);</code></div><div class="line number321 index320 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//把已连接描述字通过父子Unix域管道传递给子进程</code></div><div class="line number322 index321 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//close(connfd);</code></div><div class="line number323 index322 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number324 index323 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(--nset==0)</code></div><div class="line number325 index324 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">continue</code><code class="cpp plain">;</code></div><div class="line number326 index325 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// server 0.5</code></div><div class="line number327 index326 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//for select</code></div><div class="line number328 index327 alt1">&nbsp;</div><div class="line number329 index328 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number330 index329 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// server 0.5</code></div><div class="line number331 index330 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">char</code> <code class="cpp plain">rcc;</code></div><div class="line number332 index331 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">for</code> <code class="cpp plain">( i=0;i&lt;nchildren;i++)</code></div><div class="line number333 index332 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number334 index333 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(FD_ISSET(cptr[i].child_pipefd,&amp;rset))</code></div><div class="line number335 index334 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{</code></div><div class="line number336 index335 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">( ( n=read(cptr[i].child_pipefd,&amp;rcc,1))==0)</code></div><div class="line number337 index336 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">{&nbsp;&nbsp; </code><code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"child %d terminated unexpectedly"</code><code class="cpp plain">,i);</code><code class="cpp keyword bold">return</code> <code class="cpp plain">0;}</code></div><div class="line number338 index337 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">else</code> <code class="cpp functions bold">printf</code><code class="cpp plain">(</code><code class="cpp string">"recycle client process: %d\n"</code><code class="cpp plain">,i);</code></div><div class="line number339 index338 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">//write过来的没有结束符，所以在write加个\n来表示行结束</code></div><div class="line number340 index339 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">cptr[i].child_status=0;</code></div><div class="line number341 index340 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">navail++;</code></div><div class="line number342 index341 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code><code class="cpp plain">(--nset==0)</code></div><div class="line number343 index342 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">break</code><code class="cpp plain">;</code></div><div class="line number344 index343 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number345 index344 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number346 index345 alt1">&nbsp;</div><div class="line number347 index346 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number348 index347 alt1"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>　　</p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span style="font-family: 宋体; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 宋体; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;"></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><span style="font-family: Calibri;" face="Calibri"><o:p></o:p></span></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><o:p><span style="font-family: Calibri;" face="Calibri">&nbsp;</span></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p>
<p style="margin: 0cm 0cm 0pt;" class="MsoNormal"><span lang="EN-US"><o:p><span style="font-family: Calibri;" face="Calibri">&nbsp;</span></o:p></span></p>
<p><span style="font-family: Times New Roman; font-size: small;" face="Times New Roman" size="3">

</span></p></div><div id="MySignature"><br><font style="background-color: #ffffff"></font>作者：<a href="http://www.cnblogs.com/aga-j/" target="_blank">Aga.J</a> <br>出处：<a href="http://www.cnblogs.com/aga-j" target="_blank">http://www.cnblogs.com/aga-j</a> <br>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。<br>
个人学习笔记仅供本人记录知识所用，不属发表性文章。</div>
        
<script type="text/javascript">
var isLogined = false;
var cb_blogId = 70057;
var cb_entryId = 2180658;
var cb_blogApp = currentBlogApp;
var cb_blogUserGuid = "30c2bc30-7c54-df11-ba8f-001cf0cd104b";
var cb_entryCreatedDate = '2011/9/18 21:11:00';
var enableGoogleAd = true;
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
</script>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="blog_post_info"><div id="BlogPostCategory">分类: <a href="http://www.cnblogs.com/aga-j/category/311403.html">Linux</a></div>
<div id="EntryTag"></div>
<div id="green_channel">
绿色通道：
<a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(cb_entryId,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
<a id="green_channel_follow" onclick="c_follow();" href="javascript:void(0);">关注我</a>
<a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a><a id="green_channel_contact" href="http://space.cnblogs.com/msg/send/Aga.J" target="_blank">与我联系</a>
<a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./09_files/icon_weibo_24.png" alt=""></a>
</div>
<div id="digg_block">
<div id="author_profile">
<div id="author_profile_info" class="author_profile_info">
<div id="author_profile_detail" class="author_profile_info">
<a href="http://home.cnblogs.com/u/aga-j/">Aga.J</a><br>
<a href="http://home.cnblogs.com/u/aga-j/followees">关注 - 18</a><br>
<a href="http://home.cnblogs.com/u/aga-j/followers">粉丝 - 44</a>
</div>
</div>
<div class="clear"></div>
<div id="author_profile_honor"></div>
<div id="author_profile_follow">
<a href="javascript:void(0);" onclick="c_follow();return false;">+加关注</a>
</div>
</div>
<div id="div_digg">										
	<div class="diggit" onclick="votePost(cb_entryId,&#39;Digg&#39;)"> 
		<span class="diggnum" id="digg_count">0</span>
	</div>
	<div class="buryit" onclick="votePost(cb_entryId,&#39;Bury&#39;)"> 
		<span class="burynum" id="bury_count">0</span>
	</div>
	<div class="clear"></div>	
	<div class="diggword" id="digg_tips">
    (请您对文章做出评价)
    </div>	
</div>
</div></div>
<div class="clear"></div>
<div id="post_next_prev"><a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180609.html" class="p_n_p_prefix">« </a> 博主上一篇：<a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180609.html" title="发布于2011-09-18 20:00">Linux TCP server系列（6）-select模式下的多线程server</a><br><a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180687.html" class="p_n_p_prefix">» </a> 博主下一篇：<a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180687.html" title="发布于2011-09-18 21:36">Linux TCP server系列（8）-cgi server</a><br></div>
</div>
<script type="text/javascript">
    //SyntaxHighlighter.config.strings.expandSource = '<span><img src="http://static.cnblogs.com/images/expand-code.gif" alt="" class="expand-code-icon"/>View Code</span>';
    $(function () {             
        fixPostBodyFormat();
        loadAdUnderPost();
        loadBlogSignature();
        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);        
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);        
    });
</script>
    </div>
    <span><img src="./09_files/2180658.html" width="1" height="1" alt=""></span>
    <ul class="postmetadata">
        <li id="ctl01_liCate" class="icon_cat"><strong>Categories: </strong>
            <a href="http://www.cnblogs.com/aga-j/category/311403.html">Linux</a>            
        </li>
        
        
    </ul>
</div>

<script language="javascript" type="text/javascript">
    var m = window.__blog.postRendered;
    if (m) { m(__$("post")); }
</script>

<script language="javascript" type="text/javascript">
    var m = window.__blog.postRenderPosts;
    if (m) { m(); }
</script><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.loadComments();</script>
<div id="comment_form" class="commentform">
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" id="lnk_RefreshComments" onclick="return RefreshCommentList();">刷新评论</a><a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180658.html#" onclick="return RefreshPage();">刷新页面</a><a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180658.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>

<script type="text/javascript">
    if (typeof commentManager === 'undefined') {
        commentManager = new blogCommentManager();
    }
    commentManager.loadCommentForm();   
</script>

<div class="ad_text_commentbox" id="ad_text_under_commentbox"><a href="http://zt.cnblogs.com/ie10/" target="_blank"><b>IE10：全面支持HTML5，让你创造更多</b></a><br><a href="http://job.cnblogs.com/" target="_blank"><b>找优秀程序员，就在博客园</b></a><br></div>
<div id="site_nav_under"><a href="http://www.cnblogs.com/" target="_blank" title="程序员的网上家园">博客园首页</a><a href="http://q.cnblogs.com/" target="_blank" title="程序员问答社区">博问</a><a href="http://news.cnblogs.com/" target="_blank" title="IT新闻">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></div>
<div id="ad_under_post_holder">
<div id="google_ad_c1" class="c_ad_block">
    <!-- cnblogs_blogpost_C1_sitehome -->
    <div id="div-gpt-ad-1346480159711-0" style="width:300px; height:250px;">
    
    </div>
</div>
<div id="blog_news_kb"><div class="itnews c_ad_block"><b>最新IT新闻</b>:<br> ·  <a href="http://news.cnblogs.com/n/169051/" target="_blank">微软需立即解决Windows 8问题已拖累整个产业</a><br> ·  <a href="http://news.cnblogs.com/n/169050/" target="_blank">王府井电商正式上线 产品价格高于天猫</a><br> ·  <a href="http://news.cnblogs.com/n/169049/" target="_blank">惠普公布高管2012年薪水 惠特曼报酬1530万美元</a><br> ·  <a href="http://news.cnblogs.com/n/169048/" target="_blank">传百度将控股金山网络，结盟腾讯共抗360</a><br> ·  <a href="http://news.cnblogs.com/n/169047/" target="_blank">传IBM将收购大数据公司Splunk</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div><div class="itnews c_ad_block" id="kb_block"><b>最新知识库文章</b>:<br><div id="kb_recent"> ·  <a href="http://kb.cnblogs.com/page/161488/" target="_blank">你真想到了50岁还靠编程来养家糊口吗？</a><br> ·  <a href="http://kb.cnblogs.com/page/168162/" target="_blank">编写高效的JavaScript程序</a><br> ·  <a href="http://kb.cnblogs.com/page/161717/" target="_blank">Javascript 模块化编程</a><br> ·  <a href="http://kb.cnblogs.com/page/110513/" target="_blank">使用CSS的类名交集复合选择器</a><br> ·  <a href="http://kb.cnblogs.com/page/168552/" target="_blank">马云专访全文：商业王国、孤独感、管理艺术</a><br></div>» <a href="http://kb.cnblogs.com/" target="_blank">更多知识库文章...</a></div></div>
<div id="google_ad_c2" class="c_ad_block">
    <!-- cnblogs_blogpost_C2_sitehome -->
    <div id="div-gpt-ad-1346479110744-1" style="width:468px; height:60px;">
    
    </div>
</div></div>
<div id="HistoryToday" class="c_ad_block"></div>
</div>





        </div>
        
	    <script language="javascript" type="text/javascript">
	               var m = window.__blog.contentRendered;
	               if (m) { m(__$("content")); }
        </script>

	    <div id="sidebar">
			    

<div id="about">
    <div>
        <h2 id="about_title">
            About
        </h2>
        <div id="about_body">
        <div id="blog-news" style=""><!-- JiaThis Button BEGIN -->
<div style="position:absolute;width:0px;height:0px;"><div style="display: block; cursor: pointer; text-align: center; width: 0px; height: 0px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="0" height="0" id="JIATHISSWF" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" style="display: none !important;"><param name="allowScriptAccess" value="always"><param name="swLiveConnect" value="true"><param name="movie" value="http://www.jiathis.com/code/swf/m.swf"><param name="FlashVars" value="z=a"><div style="display: block; cursor: pointer; text-align: center; width: 0px; height: 0px; top: auto; left: auto; position: static;"><div style="-webkit-transition: opacity 150ms ease-out; background-image: url(chrome-extension://gofhjkjmkpinhpoiabjplobcaignabnl/icon_play.png); text-align: left; opacity: 0.25; border: 1px solid rgb(0, 0, 0); width: 100%; height: 100%; background-color: rgba(193, 217, 244, 0.498039); background-repeat: no-repeat no-repeat;"></div></div><embed name="JIATHISSWF" src="http://www.jiathis.com/code/swf/m.swf" flashvars="z=a" width="0" height="0" allowscriptaccess="always" swliveconnect="true" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" style="display: none !important;"></object></div>
<!-- JiaThis Button END -->
<div id="profile_block">昵称：<a href="http://home.cnblogs.com/u/aga-j/">Aga.J</a><br>园龄：<a href="http://home.cnblogs.com/u/aga-j/" title="入园时间：2010-05-01">2年8个月</a><br>粉丝：<a href="http://home.cnblogs.com/u/aga-j/followers/">44</a><br>关注：<a href="http://home.cnblogs.com/u/aga-j/followees/">18</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="cnblogs.UserManager.FollowBlogger(&#39;30c2bc30-7c54-df11-ba8f-001cf0cd104b&#39;)">+加关注</a></div></div></div>
        </div>
    </div>
</div>

			    <script language="javascript" type="text/javascript">
                        var m = window.__blog.aboutRendered;
                        if (m) { m(__$("about")); }
                </script>
                
<script type="text/javascript">
function zzk_go()
{
	var blogapp = 'aga-j';
	var keystr = encodeURIComponent("blog:"+blogapp+" "+document.getElementById('q').value);
    window.location = "http://zzk.cnblogs.com/s?w="+keystr;
}
function zzk_go_enter(event)
{
	if(event.keyCode == 13)
	{
	    zzk_go();
	    return false;
	}
}
</script>

<div id="mySearchWrapper">
    <div id="mySearch">
        <input type="image" src="./09_files/btnsearch.gif" id="btnZzk" class="submit" onclick="zzk_go();return false;">
        <label class="lb_search"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="keyword"></label>
    </div>
</div>

                <script language="javascript" type="text/javascript">
                                var m = window.__blog.searchFormRendered;
                                if (m) { m(__$("searchform")); }
                </script>
                <div id="sideMain">
                <div id="side-recent-posts">
<h2>最新随笔</h2>
 <ul class="bullet">

		<li><a href="http://www.cnblogs.com/aga-j/archive/2012/12/15/2820035.html">Machine Learning 第四课</a></li>
	
		<li><a href="http://www.cnblogs.com/aga-j/archive/2012/11/18/2776129.html">Machine Learning 第三课（下）</a></li>
	
		<li><a href="http://www.cnblogs.com/aga-j/archive/2012/11/18/2775863.html">Machine Learning 第三课（上）</a></li>
	
		<li><a href="http://www.cnblogs.com/aga-j/archive/2012/10/28/2743691.html">Machine Learning第二课</a></li>
	
		<li><a href="http://www.cnblogs.com/aga-j/archive/2012/10/27/2742609.html">Stanford公开课Machine learning第一课</a></li>
	
		<li><a href="http://www.cnblogs.com/aga-j/archive/2012/02/15/2353124.html">20120215 今天是我在公司实习的最后一天</a></li>
	
		<li><a href="http://www.cnblogs.com/aga-j/archive/2012/02/03/2337440.html">Twitter Storm 实时数据处理框架分析总结</a></li>
	
		<li><a href="http://www.cnblogs.com/aga-j/archive/2012/02/03/2337151.html">Yahoo!S4分布式流处理引擎分析总结</a></li>
	
		<li><a href="http://www.cnblogs.com/aga-j/archive/2012/01/05/2312865.html">好久没写博客，所以在谷歌和百度上搜"aga"的时候我的博客已经不再在搜索结果的第一条里，只能搜"aga-j"。</a></li>
	
		<li><a href="http://www.cnblogs.com/aga-j/archive/2011/12/02/2272633.html">疯人疯语</a></li>
	
</ul>
</div></div>
                <div id="sideRight">
                <div id="side-archives">
<h2>随笔档案</h2>
<ul class="date">

 <li><a href="http://www.cnblogs.com/aga-j/archive/2012/12.html">2012年12月(1)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2012/11.html">2012年11月(2)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2012/10.html">2012年10月(2)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2012/02.html">2012年2月(3)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2012/01.html">2012年1月(1)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/12.html">2011年12月(1)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/11.html">2011年11月(4)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/10.html">2011年10月(3)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/09.html">2011年9月(11)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/08.html">2011年8月(6)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/07.html">2011年7月(14)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/06.html">2011年6月(29)</a></li>
 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/09/18/2180658.html#" onclick="document.getElementById(&#39;div_month_more&#39;).style.display=&#39;block&#39;;this.parentNode.style.display=&#39;none&#39;;return false;">更多...</a></li></ul><ul style="display:none" class="date" id="div_month_more">

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/05.html">2011年5月(3)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/04.html">2011年4月(15)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/03.html">2011年3月(8)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/02.html">2011年2月(8)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2011/01.html">2011年1月(6)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2010/12.html">2010年12月(3)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2010/11.html">2010年11月(5)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2010/10.html">2010年10月(2)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2010/08.html">2010年8月(11)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2010/07.html">2010年7月(10)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2010/06.html">2010年6月(1)</a></li>
 

 <li><a href="http://www.cnblogs.com/aga-j/archive/2010/05.html">2010年5月(10)</a></li>
 

</ul>
</div>











<div id="blog-calendar-block" style="">
<div id="side-calendar">
<h2>日历</h2>
<div id="blog-calendar"><table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2012/12/01&#39;);return false;">&lt;</a></td><td align="center">2013年1月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2013/02/01&#39;);return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" align="center" abbr="日" scope="col">日</th><th class="CalDayHeader" align="center" abbr="一" scope="col">一</th><th class="CalDayHeader" align="center" abbr="二" scope="col">二</th><th class="CalDayHeader" align="center" abbr="三" scope="col">三</th><th class="CalDayHeader" align="center" abbr="四" scope="col">四</th><th class="CalDayHeader" align="center" abbr="五" scope="col">五</th><th class="CalDayHeader" align="center" abbr="六" scope="col">六</th></tr><tr><td class="CalOtherMonthDay" align="center">30</td><td class="CalOtherMonthDay" align="center">31</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td class="CalWeekendDay" align="center">5</td></tr><tr><td class="CalWeekendDay" align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td align="center">10</td><td align="center">11</td><td class="CalTodayDay" align="center">12</td></tr><tr><td class="CalWeekendDay" align="center">13</td><td align="center">14</td><td align="center">15</td><td align="center">16</td><td align="center">17</td><td align="center">18</td><td class="CalWeekendDay" align="center">19</td></tr><tr><td class="CalWeekendDay" align="center">20</td><td align="center">21</td><td align="center">22</td><td align="center">23</td><td align="center">24</td><td align="center">25</td><td class="CalWeekendDay" align="center">26</td></tr><tr><td class="CalWeekendDay" align="center">27</td><td align="center">28</td><td align="center">29</td><td align="center">30</td><td align="center">31</td><td class="CalOtherMonthDay" align="center">1</td><td class="CalOtherMonthDay" align="center">2</td></tr><tr><td class="CalOtherMonthDay" align="center">3</td><td class="CalOtherMonthDay" align="center">4</td><td class="CalOtherMonthDay" align="center">5</td><td class="CalOtherMonthDay" align="center">6</td><td class="CalOtherMonthDay" align="center">7</td><td class="CalOtherMonthDay" align="center">8</td><td class="CalOtherMonthDay" align="center">9</td></tr>
</tbody></table></div>
</div>
</div><div id="side-link-304681">
    <h2>博客链接</h2>
    <ul class="chain">
    
        <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j-2nd/">Rss</a>
        <a href="http://www.cnblogs.com/aga-j-2nd/" target="_blank">收藏好文章的博客</a></li>
    
    </ul>
</div></div>
                <div id="sideLeft">            
                <div id="side-categories">
<h2>随笔分类</h2>
<ul class="folder">

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/285341.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/285341.html">Algorithm(13)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/285335.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/285335.html">Android(4)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/292961.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/292961.html">C/C++(24)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/285337.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/285337.html">Course(2)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/299169.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/299169.html">Data Mining(4)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/287742.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/287742.html">dot net(3)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/285334.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/285334.html">J2EE(10)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/285331.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/285331.html">Life(26)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/311403.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/311403.html">Linux(22)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/423421.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/423421.html">Machine Learning(4)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/304600.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/304600.html">Nice Article(2)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/285339.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/285339.html">Object-Oriented(14)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/285338.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/285338.html">Other(7)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/351819.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/351819.html">stream computing, real-time computing(2)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/285329.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/285329.html">Windows Mobile(5)</a> </li>

 <li><a class="mini_rss" href="http://www.cnblogs.com/aga-j/category/285330.html/rss">Rss</a>
 <a href="http://www.cnblogs.com/aga-j/category/285330.html">Windows Phone(14)</a> </li>

</ul>
</div><div id="side-top-posts-custom">
<h2>推荐排行榜</h2>
	<div id="TopDiggPostsBlock"><ul><li><a href="http://www.cnblogs.com/aga-j/archive/2011/07/02/2096294.html">1. mongoDB是什么？又吸引我的注意力了(3)</a></li><li><a href="http://www.cnblogs.com/aga-j/archive/2011/02/07/1949658.html">2. android开发小技巧笔记(3)</a></li><li><a href="http://www.cnblogs.com/aga-j/archive/2011/01/14/1935436.html">3. windows phone xna游戏视频展示 及 xna开发书籍下载(3)</a></li><li><a href="http://www.cnblogs.com/aga-j/archive/2010/05/19/1739635.html">4. 最近(2)</a></li><li><a href="http://www.cnblogs.com/aga-j/archive/2010/11/13/1876610.html">5. Windows phone 手势，鼠标-学习笔记(2)</a></li></ul></div>
</div><div id="side-top-posts">
<h2>阅读排行榜</h2>
	<div id="TopViewPostsBlock"><ul><li><a href="http://www.cnblogs.com/aga-j/archive/2011/07/02/2096294.html">1. mongoDB是什么？又吸引我的注意力了(2804)</a></li><li><a href="http://www.cnblogs.com/aga-j/archive/2010/08/09/1795375.html">2. 关于使用OpenNetCF完成windows mobile上的wifi通信(2599)</a></li><li><a href="http://www.cnblogs.com/aga-j/archive/2012/02/03/2337440.html">3. Twitter Storm 实时数据处理框架分析总结(2263)</a></li><li><a href="http://www.cnblogs.com/aga-j/archive/2010/08/17/1801725.html">4. 看着这个实例，一起来学重构吧！(1873)</a></li><li><a href="http://www.cnblogs.com/aga-j/archive/2012/02/03/2337151.html">5. Yahoo!S4分布式流处理引擎分析总结(1863)</a></li></ul></div>
</div></div>
			    
			    <div id="sideContainer"></div>
                <script language="javascript" type="text/javascript">
                    $.ajax({
                        url: '/' + currentBlogApp + '/mvc/blog/Minyx2_Lite_SideColumn.aspx',
                        data: '{}',
                        type: 'post',
                        dataType: 'text',
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            if (data) {
                                $("#sideContainer").html(data);
                                if ($("#blog-calendar").length) {
                                    loadBlogCalendar();
                                }
                                loadBlogSideBlocks();
                                var m = window.__blog.sideContainerRendered;
                                if (m) { m(__$("sideContainer")); }
                                window.__blog.sidebar.__layout();
                            }
                        }
                    });
                    
                 </script>       	
			                      
 		    </div>
     		
	        <script language="javascript" type="text/javascript">
	        var m = window.__blog.sidebarRendered;
	        if (m) { m(__$("sidebar")); }
                </script>        
     </div>
     
        <script language="javascript" type="text/javascript">
            var m = window.__blog.wrapperRendered;
            if (m) { m(__$("wrapper")); }
        </script>

</div>
<!-- end of container -->
    
<script language="javascript" type="text/javascript">
    var m = window.__blog.containerRendered;
    if (m) { m(__$("container")); }
</script>

<div id="footer">
        
<p id="logoFoot">
    <a href="http://www.spiga.com.mx/" title="Agencia Interactiva Spiga">www.spiga.com.mx</a>
</p>
<div class="footText">
<p>
Copyright ©2013 Aga.J
</p>
<p>
<a href="http://www.cnblogs.com/">博客园</a>
</p>
</div>
</div><!--end: footer -->

<!--PageEndHtml Block Begin-->
<div id="clustrmaps-widget" style="width: 160px; height: 106px; position: relative;"><a href="http://www3.clustrmaps.com/counter/maps.php?url=http://www.cnblogs.com/aga-j/" style="border: none;"><img style="background-image: url(http://www3.clustrmaps.com/images/nasa_classic.jpg); border: none; position: absolute; left: 0px; top: 0px; padding: 0px; background-position: initial initial; background-repeat: initial initial;" src="./09_files/www.cnblogs.com-aga-j--thumb-text.png"><img src="./09_files/www.cnblogs.com-aga-j--thumb-dots.png" style="position: absolute; border: none; z-index: 1; left: 0px; top: 0px; padding: 0px;"><script src="./09_files/dynamic.js"></script><img style="left: 129px; top: 49px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 128px; top: 41px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 129px; top: 45px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 21px; top: 37px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 130px; top: 40px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 129px; top: 47px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 128px; top: 45px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 127px; top: 41px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 126px; top: 49px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 126px; top: 49px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"><img style="left: 21px; top: 37px; position: absolute; width: 9px; height: 9px; border: none; display: inline; z-index: 1; padding: 0px;" src="./09_files/smallyellow.png"></a></div><script type="text/javascript">var _clustrmaps = {'url' : 'http://www.cnblogs.com/aga-j/', 'user' : 968124, 'server' : '3', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2011-12-29', 'lang' : 'zh', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www3.clustrmaps.com/counter/map.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script><noscript>&lt;a href="http://www3.clustrmaps.com/user/584ec5bc"&gt;&lt;img src="http://www3.clustrmaps.com/stats/maps-no_clusters/www.cnblogs.com-aga-j--thumb.jpg" alt="Locations of visitors to this page" /&gt;&lt;/a&gt;</noscript>

<!--PageEndHtml Block End-->
<script type="text/javascript" src="./09_files/google-analytics.js"></script>


</body></html>