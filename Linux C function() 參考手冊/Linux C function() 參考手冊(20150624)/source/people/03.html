<html>
<head>
<title>Untitled Document</title>
</head>
<body>
<table width="100%">
  <tr> 
    <td valign="top" width="80">　 
      <div align="right"><br>
        <font face='宋體' size='2'><a name=linuxc25></a></font> </div>
    </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> <br>
        </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> <br>
      calloc（配置內存空間） </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 相關函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> malloc，free，realloc，brk<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 表頭文件 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> #include &lt;stdlib.h&gt;<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 定義函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> void *calloc(size_t nmemb，size_t 
      size);<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 函數說明 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> calloc()用來配置nmemb個相鄰的內存單位，每一單位的大小為size，並返回指向第一個元素的指針。這和使用下列的方式效果相同:malloc(nmemb*size);不過，在利用calloc()配置內存時會將內存內容初始化為0。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 返回值 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> 若配置成功則返回一指針，失敗則返回NULL。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 範例 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> /* 動態配置10個struct test 空間*/<br>
      #include&lt;stdlib.h&gt;<br>
      struct test<br>
      {<br>
      int a[10];<br>
      char b[20];<br>
      }<br>
      main()<br>
      {<br>
      struct test *ptr=calloc(sizeof(struct test),10);<br>
      }<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80">　 
      <div align="right"><br>
        <font face='宋體' size='2'><a name=linuxc26></a></font> </div>
    </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> <br>
        </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> <br>
      free（釋放原先配置的內存） </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 相關函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> malloc，calloc，realloc，brk<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 表頭文件 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> #include&lt;stdlib.h&gt;<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 定義函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> void free(void *ptr);<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 函數說明 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> 參數ptr為指向先前由malloc()、calloc()或realloc()所返回的內存指針。調用free()後ptr所指的內存空間便會被收回。假若參數ptr所指的內存空間已被收回或是未知的內存地址，則調用free()可能會有無法預期的情況發生。若參數ptr為NULL，則free()不會有任何作用。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80">　 
      <div align="right"><br>
        <font face='宋體' size='2'><a name=linuxc27></a></font> </div>
    </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> <br>
        </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> <br>
      getpagesize（取得內存分頁大小） </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 相關函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> sbrk<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 表頭文件 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> #include&lt;unistd.h&gt;<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 定義函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> size_t getpagesize(void);<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 函數說明 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> 返回一分頁的大小，單位為字節（byte）。此為系統的分頁大小，不一定會和硬件分頁大小相同。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 返回值 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> 內存分頁大小。附加說明在Intel x86 上其返回值應為4096bytes。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 範例 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> #include &lt;unistd.h&gt;<br>
      main()<br>
      {<br>
      printf(“page size = %d\n”,getpagesize( ) );<br>
      }<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80">　 
      <div align="right"><br>
        <font face='宋體' size='2'><a name=linuxc28></a></font> </div>
    </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> <br>
        </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> <br>
      malloc（配置內存空間） </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 相關函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> calloc，free，realloc，brk<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 表頭文件 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> #include&lt;stdlib.h&gt;<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 定義函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> void * malloc(size_t size);<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 函數說明 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> malloc()用來配置內存空間，其大小由指定的size決定。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 返回值 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> 若配置成功則返回一指針，失敗則返回NULL。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 範例 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> void p = malloc(1024); /*配置1k的內存*/<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80">　 
      <div align="right"><br>
        <font face='宋體' size='2'><a name=linuxc29></a></font> </div>
    </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> <br>
        </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> <br>
      mmap（建立內存映射） </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 相關函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> munmap，open<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 表頭文件 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> #include &lt;unistd.h&gt;<br>
      #include &lt;sys/mman.h&gt;<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 定義函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> void *mmap(void *start,size_t 
      length,int prot,int flags,int fd,off_t offsize);<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 函數說明 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> mmap()用來將某個文件內容映射到內存中，對該內存區域的存取即是直接對該文件內容的讀寫。參數start指向欲對應的內存起始地址，通常設為NULL，代表讓系統自動選定地址，對應成功後該地址會返回。參數length代表將文件中多大的部分對應到內存。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 參數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> prot代表映射區域的保護方式有下列組合<br>
      PROT_EXEC 映射區域可被執行<br>
      PROT_READ 映射區域可被讀取<br>
      PROT_WRITE 映射區域可被寫入<br>
      PROT_NONE 映射區域不能存取<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 參數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> flags會影響映射區域的各種特性<br>
      MAP_FIXED 如果參數start所指的地址無法成功建立映射時，則放棄映射，不對地址做修正。通常不鼓勵用此旗標。<br>
      MAP_SHARED對映射區域的寫入數據會複製迴文件內，而且允許其他映射該文件的進程共享。<br>
      MAP_PRIVATE 對映射區域的寫入操作會產生一個映射文件的複製，即私人的“寫入時複製”（copy on write）對此區域作的任何修改都不會寫回原來的文件內容。<br>
      MAP_ANONYMOUS建立匿名映射。此時會忽略參數fd，不涉及文件，而且映射區域無法和其他進程共享。<br>
      MAP_DENYWRITE只允許對映射區域的寫入操作，其他對文件直接寫入的操作將會被拒絕。<br>
      MAP_LOCKED 將映射區域鎖定住，這表示該區域不會被置換（swap）。<br>
      在調用mmap()時必須要指定MAP_SHARED 或MAP_PRIVATE。參數fd為open()返回的文件描述詞，代表欲映射到內存的文件。參數offset為文件映射的偏移量，通常設置為0，代表從文件最前方開始對應，offset必須是分頁大小的整數倍。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 返回值 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> 若映射成功則返回映射區的內存起始地址，否則返回MAP_FAILED(－1)，錯誤原因存於errno 
      中。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 錯誤代碼 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> EBADF 參數fd 不是有效的文件描述詞<br>
      EACCES 存取權限有誤。如果是MAP_PRIVATE 情況下文件必須可讀，使用MAP_SHARED則要有PROT_WRITE以及該文件要能寫入。<br>
      EINVAL 參數start、length 或offset有一個不合法。<br>
      EAGAIN 文件被鎖住，或是有太多內存被鎖住。<br>
      ENOMEM 內存不足。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 範例 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> /* 利用mmap()來讀取/etc/passwd 文件內容*/<br>
      #include&lt;sys/types.h&gt;<br>
      #include&lt;sys/stat.h&gt;<br>
      #include&lt;fcntl.h&gt;<br>
      #include&lt;unistd.h&gt;<br>
      #include&lt;sys/mman.h&gt;<br>
      main()<br>
      {<br>
      int fd;<br>
      void *start;<br>
      struct stat sb;<br>
      fd=open(“/etc/passwd”,O_RDONLY); /*打開/etc/passwd*/<br>
      fstat(fd,&sb); /*取得文件大小*/<br>
      start=mmap(NULL,sb.st_size,PROT_READ,MAP_PRIVATE,fd,0);<br>
      if(start= = MAP_FAILED) /*判斷是否映射成功*/<br>
      return;<br>
      printf(“%s”,start);<br>
      munma(start,sb.st_size); /*解除映射*/<br>
      closed(fd);<br>
      }<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 執行 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> root : x : 0 : root : /root : 
      /bin/bash<br>
      bin : x : 1 : 1 : bin : /bin :<br>
      daemon : x : 2 : 2 :daemon : /sbin<br>
      adm : x : 3 : 4 : adm : /var/adm :<br>
      lp : x :4 :7 : lp : /var/spool/lpd :<br>
      sync : x : 5 : 0 : sync : /sbin : bin/sync :<br>
      shutdown : x : 6 : 0 : shutdown : /sbin : /sbin/shutdown<br>
      halt : x : 7 : 0 : halt : /sbin : /sbin/halt<br>
      mail : x : 8 : 12 : mail : /var/spool/mail :<br>
      news : x :9 :13 : news : /var/spool/news :<br>
      uucp : x :10 :14 : uucp : /var/spool/uucp :<br>
      operator : x : 11 : 0 :operator : /root:<br>
      games : x : 12 :100 : games :/usr/games:<br>
      gopher : x : 13 : 30 : gopher : /usr/lib/gopher-data:<br>
      ftp : x : 14 : 50 : FTP User : /home/ftp:<br>
      nobody : x :99: 99: Nobody : /:<br>
      xfs :x :100 :101 : X Font Server : /etc/xll/fs : /bin/false<br>
      gdm : x : 42 :42 : : /home/gdm: /bin/bash<br>
      kids : x : 500 :500 :/home/kids : /bin/bash<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80">　 
      <div align="right"><br>
        <font face='宋體' size='2'><a name=linuxc30></a></font> </div>
    </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> <br>
        </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> <br>
      munmap（解除內存映射） </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 相關函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> mmap<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 表頭文件 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> #include&lt;unistd.h&gt;<br>
      #include&lt;sys/mman.h&gt;<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 定義函數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> int munmap(void *start,size_t 
      length);<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 函數說明 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> munmap()用來取消參數start所指的映射內存起始地址，參數length則是欲取消的內存大小。當進程結束或利用exec相關函數來執行其他程序時，映射內存會自動解除，但關閉對應的文件描述詞時不會解除映射。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 返回值 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> 如果解除映射成功則返回0，否則返回－1，錯誤原因存於errno中錯誤代碼EINVAL<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 參數 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> start或length 不合法。<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80"> 
      <div align="right"><font face='宋體' size='2'> 範例 </font> </div>
    </td>
    <td valign="top"> <font face='宋體' size='2'> 參考mmap（）<br>
      </font> </td>
  </tr>
  <tr> 
    <td valign="top" width="80">　 
      <div align="right"><br>
      </div>
    </td>
  </tr>
</table>
</body>
</html>
