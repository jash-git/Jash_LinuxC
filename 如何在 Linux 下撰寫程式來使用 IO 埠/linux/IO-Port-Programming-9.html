<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="zh-TW" xml:lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <meta http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html"  labels ratings (ca 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html"  labels ratings (n 0 s 0 v 0 l 0))'/>
 <title>如何在 Linux 下撰寫程式來使用 I/O 埠: 程式碼範例</title>
 <link href="IO-Port-Programming-10.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-10.html" rel="next" />
 <link href="IO-Port-Programming-8.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-8.html" rel="previous" />
 <link href="index.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/index.html" rel="contents" />
  <link href="index.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/index.html" rel="start" />
  <link href="IO-Port-Programming-1.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-1.html" rel="chapter" title="1.介紹" />
 <link href="IO-Port-Programming-2.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-2.html" rel="chapter" title="2.如何在 C 語言下使用 I/O 埠" />
 <link href="IO-Port-Programming-3.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-3.html" rel="chapter" title="3.硬體中斷 (IRQs) 與 DMA 存取" />
 <link href="IO-Port-Programming-4.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-4.html" rel="chapter" title="4.高精確的時序" />
 <link href="IO-Port-Programming-5.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-5.html" rel="chapter" title="5.使用其他程式語言" />
 <link href="IO-Port-Programming-6.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-6.html" rel="chapter" title="6.一些有用的 I/O 埠" />
 <link href="IO-Port-Programming-7.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-7.html" rel="chapter" title="7.提示 " />
 <link href="IO-Port-Programming-8.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-8.html" rel="chapter" title="8.問題排除" />
 <link href="IO-Port-Programming-9.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-9.html" rel="chapter" title="9.程式碼範例" />
 <link href="IO-Port-Programming-10.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-10.html" rel="chapter" title="10.致謝" />
 <link href="javascript:if(confirm('http://tldp.org/HOWTO/mini/IO-Port-Programming.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://tldp.org/HOWTO/mini/IO-Port-Programming.html'" tppabs="http://tldp.org/HOWTO/mini/IO-Port-Programming.html" rel="alternate" title="原版" />
 <link href="IO-Port-Programming.rdf" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming.rdf" rel="meta" title="各章節的說明資訊" />
 <link href="style.css" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/style.css" rel="stylesheet" type="text/css" />
 <link href="javascript:if(confirm('http://sunsite.unc.edu/pub/Linux/docs/HOWTO/COPYRIGHT  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://sunsite.unc.edu/pub/Linux/docs/HOWTO/COPYRIGHT'" tppabs="http://sunsite.unc.edu/pub/Linux/docs/HOWTO/COPYRIGHT" rel="copyright" title="版權" />
</head> <body> 
<table




>
  <tr
>
    <th
colspan="3" class="HdTitle"
>Mini
    HOWTO：Linux I/O port programming</th>
  </tr
>
  <tr
>
    <td class="TtdL"
><a href="IO-Port-Programming-8.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-8.html" accesskey="P">上一頁(P)</a></td
>
    <td class="TtdC"
></td
>
    <td class="TtdR"
><a href="IO-Port-Programming-10.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-10.html" accesskey="N">下一頁(N)</a></td
>
  </tr
>
</table
>
<hr />
<h1><a name="s9" id="s9">9.</a> 程式碼範例</h1>

<p>這邊是一段用來存取 I/O 埠的簡單的程式碼範例:</p>
<p></p>
<pre class="sample">
/*
 * example.c: 一個用來存取 I/O 埠的非常簡單的範例
 *
 * 這個程式碼並沒有什麼用處, 他只是做了埠的寫入, 暫停, 
 * 以及埠的讀出幾個動作. 編譯時請使用 `gcc -O2 -o example example.c',
 * 並以 root 的身份執行 `./example'.
 */

#include &lt;stdio.h>
#include &lt;unistd.h>
#include &lt;asm/io.h>

#define BASEPORT 0x378 /* lp1 */

int main()
{
  /* 取得埠位址的存取權限 */
  if (ioperm(BASEPORT, 3, 1)) {perror("ioperm"); exit(1);}
  
  /* 設定埠的輸出資料信號 (D0-7) 全為零 (0) */
  outb(0, BASEPORT);
  
  /* 休息一下 (100 ms) */
  usleep(100000);
  
  /* 從狀態埠 (BASE+1) 讀出資料並顯示結果 */
  printf("status: %d\n", inb(BASEPORT + 1));

  /* 我們不再需要這些埠位址 */
  if (ioperm(BASEPORT, 3, 0)) {perror("ioperm"); exit(1);}

  exit(0);
}

/* 結束 example.c */
</pre>

<hr />
<table




>
  <tr
>
    <td class="BtdL"
><a href="IO-Port-Programming-8.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-8.html" accesskey="P">上一頁(P)</a></td
>
    <td class="BtdC"
><a href="index.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/index.html" accesskey="H">目錄(H)</a></td
>
    <td class="BtdR"
><a
href="IO-Port-Programming-10.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-10.html"
>下一頁(N)</a
></td
>
  </tr
>
  <tr
>
    <td class="BtdL"
>問題排除</td
>
    <td class="BtdC"
><a href="IO-Port-Programming-9.html" tppabs="http://www.linux.org.tw/CLDP/MiniHOWTO/prog/IO-Port-Programming/IO-Port-Programming-9.html" accesskey="T">到頂層(T)</a></td
>
    <td class="BtdR"
>致謝</td
>
  </tr
>
</table
>
<div>
<a href="javascript:if(confirm('http://validator.w3.org/check/referer  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://validator.w3.org/check/referer'" tppabs="http://validator.w3.org/check/referer"><img src="valid-xhtml10.png" tppabs="http://www.linux.org.tw/CLDP/valid-xhtml10.png"  alt="符合 XHTML 1.0" width="88" height="31" style="border:0;width:88px;height:31px"/></a>
<a href="javascript:if(confirm('http://jigsaw.w3.org/css-validator/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://jigsaw.w3.org/css-validator/'" tppabs="http://jigsaw.w3.org/css-validator/"><img style="border:0;width:88px;height:31px" src="vcss.png" tppabs="http://www.linux.org.tw/CLDP/vcss.png"  alt="符合 CSS"/></a>
<a href="javascript:if(confirm('http://www.w3.org/WAI/WCAG1AA-Conformance  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.w3.org/WAI/WCAG1AA-Conformance'" tppabs="http://www.w3.org/WAI/WCAG1AA-Conformance" title="Explanation of Level Double-A Conformance"><img style="border:0;width:88px;height:32px" src="wcag1AA.gif" tppabs="http://www.linux.org.tw/CLDP/wcag1AA.gif" alt="Level Double-A conformance icon,  W3C-WAI Web Content Accessibility Guidelines 1.0"/></a>
<a href="javascript:if(confirm('http://www.w3.org/RDF/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.w3.org/RDF/'" tppabs="http://www.w3.org/RDF/" title="RDF 資源描述架構"><img  src="rdf.gif" tppabs="http://www.linux.org.tw/CLDP/rdf.gif" style="border:0" alt="表示該網頁支援資源描述架構"/></a>
</div>
</body>
</html>
