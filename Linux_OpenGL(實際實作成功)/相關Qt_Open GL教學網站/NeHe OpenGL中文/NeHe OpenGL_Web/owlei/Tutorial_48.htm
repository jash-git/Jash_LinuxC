<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- 这篇文章由Dancingwind翻译，作者的联系方式zhouwei02@mails.tsinghua.edu.cn -->
<HTML><HEAD><TITLE>NeHe OpenGL教程第四十八课，DancingWind翻译</TITLE>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<style type=text/css>
A:active {
	BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: #bbccff; TEXT-DECORATION: none
}
A:link {
	BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: #bbccff; TEXT-DECORATION: none
}
A:visited {
	BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: #bbccff; TEXT-DECORATION: none
}
A:hover {
	BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: #ffda6a; TEXT-DECORATION: none
}
BODY {
	COLOR: #ffffff; BACKGROUND-COLOR: #000000
}
TD IMG {
	DISPLAY: block
}
.back {
	BACKGROUND: #000022; COLOR: #ffffff
}
.back2 {
	BACKGROUND: #000000; COLOR: #ffffff
}
.back3 {
	BACKGROUND: #000022; COLOR: #ffffff
}
.copy {
	FONT-SIZE: 11px; LINE-HEIGHT: normal; FONT-STYLE: normal; FONT-FAMILY: Tahoma, Verdana, sans-serif; FONT-VARIANT: normal; TEXT-DECORATION: none
}
.head {
	FONT: bold 13px Tahoma, Verdana, sans-serif; TEXT-DECORATION: none
}
.link {
	FONT-SIZE: 14px; LINE-HEIGHT: normal; FONT-STYLE: normal; FONT-FAMILY: Tahoma, Verdana, sans-serif; FONT-VARIANT: normal; TEXT-DECORATION: none
}
.menu {
	FONT: bold 17px Tahoma, Verdana, sans-serif; TEXT-DECORATION: none
}
.news {
	BACKGROUND: #00008b; COLOR: #ffffff
}
.tab {
	PADDING-LEFT: 35px
}
.text {
	FONT-SIZE: 12px; LINE-HEIGHT: normal; FONT-STYLE: normal; FONT-FAMILY: Tahoma, Verdana, sans-serif; FONT-VARIANT: normal; TEXT-DECORATION: none
}
.theme {
	BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: #bbccff
}
.dotted {
	BORDER-RIGHT: #00008b 2px dotted; BORDER-TOP: #00008b 2px dotted; BORDER-LEFT: #00008b 2px dotted; BORDER-BOTTOM: #00008b 2px dotted
}
.solid {
	BORDER-RIGHT: #ffffff 1px solid; BORDER-TOP: #ffffff 1px solid; BORDER-LEFT: #ffffff 1px solid; BORDER-BOTTOM: #ffffff 1px solid
}
.logo {
	BACKGROUND-IMAGE: url(../graphics/rgb/logo.jpg)
}
.menubar {
	BACKGROUND-IMAGE: url(../graphics/rgb/menubar.jpg)
}
.menubg {
	BACKGROUND-IMAGE: url(../graphics/rgb/menubg.jpg)
}
.menuheading {
	BACKGROUND-IMAGE: url(../graphics/rgb/menuheading.jpg)
}
.nehebutton {
	BACKGROUND-IMAGE: url(../graphics/rgb/nehebutton.jpg)
}
.newslogo {
	BACKGROUND-IMAGE: url(../graphics/rgb/newslogo.jpg)
}
.tinylogo {
	BACKGROUND-IMAGE: url(../graphics/rgb/border/tinylogo.jpg)
}
.bc {
	BACKGROUND-IMAGE:  url(../Pic/bc.png)
}
.bl {
	BACKGROUND-IMAGE:  url(../Pic/bl.png)
}
.br {
	BACKGROUND-IMAGE:  url(../Pic/br.png)
}
.c {
	BACKGROUND-IMAGE: url(../Picc.png)
}
.l {
	BACKGROUND-IMAGE:  url(../Pic/l.png)
}
.lc {
	BACKGROUND-IMAGE: url(../Piclc.png)
}
.r {
	BACKGROUND-IMAGE:  url(../Pic/r.png)
}
.rc {
	BACKGROUND-IMAGE: url(../Picrc.png)
}
.tc {
	BACKGROUND-IMAGE:  url(../Pic/tc.png)
}
.tl {
	BACKGROUND-IMAGE:  url(../Pic/tl.png)
}
.tr {
	BACKGROUND-IMAGE:  url(../Pic/tr.png)
}

</style>
</head>
<BODY text=white vLink=#aaccff link=#aaccff bgColor=black>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tinylogo width=326 height=130><IMG height=130 
      alt="NeHe Productions" 
      src="logo.png" tppabs="http://www.owlei.com/DancingWind/Pic/logo.png" width=326></TD>
      <TD vAlign=center align=middle><div align="center"><FONT class=text><FONT class=theme 
      size=+3><B><I>第48课</I></B></FONT></FONT></div></TD>
  </TR></TBODY></TABLE>
  <!-- 上边框-->
<table border="0" cellPadding="0" cellSpacing="0" width="100%">
<TBODY>
  <tr>
    <td><img height="28" src="tl.jpg" tppabs="http://www.owlei.com/DancingWind/Pic/tl.jpg" width="28"></td>
    <td width="100%"><img height="28" src="tc.gif" tppabs="http://www.owlei.com/DancingWind/Pic/tc.gif" width="100%"></td>
    <td><img height="28" src="tr.gif" tppabs="http://www.owlei.com/DancingWind/Pic/tr.gif" width="28"></td>
  </tr>
</TBODY>
</table>

<!-- 中部-->
<table border="0" cellPadding="0" cellSpacing="0" width="100%">
<TBODY>
  <tr>
  	<!-- 中部左边框-->
    <td  background="l.gif" tppabs="http://www.owlei.com/DancingWind/Pic/l.gif"><img src="l.gif" tppabs="http://www.owlei.com/DancingWind/Pic/l.gif" width="28" height="28"></td>
	<!-- 中部文字部分-->
    <td vAlign="top" width="100%">
	<table width="100%" border="0">
          <tr>
            <td width="18%"><img src="lesson48.jpg" tppabs="http://www.owlei.com/DancingWind/Pic/lesson48.jpg" width="160" height="120"></td>
            <td width="82%"><p><font ><b>轨迹球实现的鼠标旋转</b></font></p>
              <p><font size="3">使用鼠标旋转物体,很简单也有很多实现方法,这里我们教会你模拟轨迹球来实现它.</font></p></td>
          </tr>
     </table>
      </td>
	<!-- 中部右边框-->
    <td background="r.gif" tppabs="http://www.owlei.com/DancingWind/Pic/r.gif"><img src="r.gif" tppabs="http://www.owlei.com/DancingWind/Pic/r.gif" width="28" height="28"></td>
  </tr>
</TBODY>
</table>

<!-- 下边框-->
<table border="0" cellPadding="0" cellSpacing="0" width="100%">
<TBODY>
  <tr>
    <td><img height="28" src="bl.gif" tppabs="http://www.owlei.com/DancingWind/Pic/bl.gif" width="28"></td>
    <td width="100%"><img height="28" src="bc.gif" tppabs="http://www.owlei.com/DancingWind/Pic/bc.gif" width="100%"></td>
    <td><img height="28" src="br.gif" tppabs="http://www.owlei.com/DancingWind/Pic/br.gif" width="28"></td>
  </tr>
</TBODY>
</table>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%">轨迹球控制<br>
        By Terence J. Grant (tjgrant@tatewake.com) 
        <p>如果只用鼠标来控制你的模型是不是很酷?轨迹球可以帮你做到这一点，我将告诉你我的实现，你可以把它应用在你的工程里。</p>
        <p>我的实现是基于Bretton Wade’s，它是基于Ken Shoemake’s 实现的，最初的版本，你可以从游戏编程指南这本图上找到。但我还是修正了一些错误，并优化了它。</p>
        <p>轨迹球实现的内容就是把二维的鼠标点映射到三维的轨迹球，并基于它完成旋转变化。</p>
        <p>为了完成这个设想，首先我们把鼠标坐标映射到[-1，1]之间，它很简单：<br>
        </p>
        <p>&nbsp;</p>
    </TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<PRE>MousePt.X  =  ((MousePt.X / ((Width  -1) / 2)) -1);<br>MousePt.Y  = -((MousePt.Y / ((Height -1) / 2))-1);</PRE>
<p></p>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%">这只是为了数学上的简化，下面我们计算这个长度，如果它大于轨迹球的边界，我们将简单的把z轴设为0，否则我们把z轴设置为这个二维点映射到球面上对应的z值。
        <p>一旦我们有了两个点，就可以计算它的法向量了和旋转角了。</p>
        <p>下面我们从构造函数开始，完整的讲解这个类：</p>
        <p>&nbsp;</p>
    </TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<PRE>ArcBall_t::ArcBall_t(GLfloat NewWidth, GLfloat NewHeight)</PRE>
<p></p>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%">当点击鼠标时，记录点击的位置 </TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<PRE>void    ArcBall_t::click(const Point2fT* NewPt)</PRE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%">当拖动鼠标时，记录当前鼠标的位置，并计算出旋转的量。 </TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<p>void ArcBall_t::drag(const Point2fT* NewPt, Quat4fT* NewRot)<br>
</p>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%">如果窗口大小改变，设置鼠标移动的范围</TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<PRE>void    ArcBall_t::setBounds(GLfloat NewWidth, GLfloat NewHeight)</PRE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%">下面是完成计算所要用到的数据结果，都是一些矩阵和向量</TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<PRE><br>Matrix4fT	Transform = {  1.0f,  0.0f,  0.0f,  0.0f,<br>			       0.0f,  1.0f,  0.0f,  0.0f,<br>			       0.0f,  0.0f,  1.0f,  0.0f,<br>			       0.0f,  0.0f,  0.0f,  1.0f };</PRE>
<p>Matrix3fT LastRot = { 1.0f, 0.0f, 0.0f, <br>
  0.0f, 1.0f, 0.0f,<br>
  0.0f, 0.0f, 1.0f };</p>
<p>Matrix3fT ThisRot = { 1.0f, 0.0f, 0.0f, <br>
  0.0f, 1.0f, 0.0f,<br>
  0.0f, 0.0f, 1.0f };</p>
<p>ArcBallT ArcBall(640.0f, 480.0f); <br>
  Point2fT MousePt; <br>
  bool isClicked = false; <span class="theme">// 是否点击鼠标</span><br>
  bool isRClicked = false; <span class="theme">// 是否右击鼠标</span><br>
  bool isDragging = false; <span class="theme">// 是否拖动</span></p>
<p></p>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%">在上面定义的变量中，transform是我们获得的最终的变换矩阵，lastRot是上一次鼠标拖动得到的旋转矩阵，thisRot为这次鼠标拖动得到的旋转矩阵。
        <p>当我们点击鼠标时，创建一个单位旋转矩阵，当我们拖动鼠标时，这个矩阵跟踪鼠标的变化。</p>
        <p>为了更新鼠标的移动范围，我们在函数ReshapeGL中加入下面一行：</p>
        <p>&nbsp;</p>
    </TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<PRE>void ReshapeGL (int width, int height)<br>{<br>	. . .<br>	ArcBall.setBounds((GLfloat)width, (GLfloat)height);			<span class="theme">	// 更新鼠标的移动范围</span><br>}</PRE>
<p><span class="theme">// 处理鼠标的按键操作</span><br>
  LRESULT CALLBACK WindowProc (HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam)<br>
  {<br>
  . . .<br>
  case WM_MOUSEMOVE:<br>
  MousePt.s.X = (GLfloat)LOWORD(lParam);<br>
  MousePt.s.Y = (GLfloat)HIWORD(lParam);<br>
  isClicked = (LOWORD(wParam) &amp; MK_LBUTTON) ? true : false;<br>
  isRClicked = (LOWORD(wParam) &amp; MK_RBUTTON) ? true : false;<br>
  break;</p>
<p> case WM_LBUTTONUP: isClicked = false; break;<br>
  case WM_RBUTTONUP: isRClicked = false; break;<br>
  case WM_LBUTTONDOWN: isClicked = true; break;<br>
  case WM_RBUTTONDOWN: isRClicked = true; break;<br>
  . . .<br>
  }</p>
<p></p>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%">为了随着输入更新我们的的状态，在Update函数中需要处理更新参数</TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<PRE>if (isRClicked)										<span class="theme">// 如果右键按下，这重置所有的变量</span><br>{<br>	Matrix3fSetIdentity(&amp;LastRot);
  Matrix3fSetIdentity(&amp;ThisRot);
  Matrix4fSetRotationFromMatrix3f(&amp;Transform, &amp;ThisRot);
  }</PRE>
<p>if (!isDragging) <span class="theme">// 如果没有拖动</span><br>
  {<br>
  if (isClicked) <span class="theme">// 第一次按下</span><br>
  {<br>
  isDragging = true; <span class="theme">// 设置拖动为变量为true</span><br>
  LastRot = ThisRot; <br>
  ArcBall.click(&amp;MousePt); <br>
  }<br>
  }<br>
  else<br>
  {<br>
  if (isClicked) <span class="theme">//如果按住拖动</span><br>
  {<br>
  Quat4fT ThisQuat;</p>
<p> ArcBall.drag(&amp;MousePt, &amp;ThisQuat); <span class="theme">// 更新轨迹球的变量</span><br>
  Matrix3fSetRotationFromQuat4f(&amp;ThisRot, &amp;ThisQuat); <span class="theme">// 
  计算旋转量</span><br>
  Matrix3fMulMatrix3f(&amp;ThisRot, &amp;LastRot); <br>
  Matrix4fSetRotationFromMatrix3f(&amp;Transform, &amp;ThisRot); <br>
  }<br>
  else<span class="theme"> // 如果放开鼠标，设置拖动为false</span><br>
  isDragging = false;<br>
  }</p>
<p></p>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%">好了，完成了上面的内容。我们到了绘制的阶段。<br>
        记住在绘制前，把我们得到的矩阵乘以当前的模型变换矩阵。</TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<PRE>glPushMatrix();									<span class="theme">// 保存当前的矩阵</span><br>	glMultMatrixf(Transform.M);							<span class="theme">// 应用我们的变换矩阵</span></PRE>
<p> glBegin(GL_TRIANGLES); <span class="theme">// 绘制模型</span><br>
  . . .<br>
  glEnd(); </p>
<p> glPopMatrix(); <span class="theme">// 弹出保存的矩阵</span></p>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=tl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=tc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
    width="100%"></TD>
    <TD class=tr><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=l><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
      <TD class=back3 vAlign=top width="100%"><p>我已经在上面给掩饰了所有的技巧，你可以不使用我告诉你的数学技巧，因为我想你会有更好的。现在你已经看到了，这是多么的简单，你完全可以按你的风格创造出更好的轨迹球。</p>
<table width="100%" border="1">
  <tr>
    <td width="27%"><img src="logo 3.jpg" tppabs="http://www.owlei.com/DancingWind/images/logo%203.jpg" width="209" height="200" align="middle"></td>
    <td width="73%">版权与使用声明:<br>
      我是个对学习和生活充满激情的普通男孩,在网络上我以DancingWind为昵称，我的联系方式是zhouwei02@mails.tsinghua.edu.cn，如果你有任何问题，都可以联系我。
      <p>引子<br>
        网络是一个共享的资源，但我在自己的学习生涯中浪费大量的时间去搜索可用的资料，在现实生活中花费了大量的金钱和时间在书店中寻找资料，于是我给自己起了个昵称DancingWind，其意义是想风一样从各个知识的站点中吸取成长的养料。在飘荡了多年之后，我决定把自己收集的资料整理为一个统一的资源库。</p>
      <p>版权声明<br>
        所有DancingWind发表的内容，大多都来自共享的资源，所以我没有资格把它们据为己有，或声称自己为这些资源作出了一点贡献。故任何人都可以复制，修改，重新发表，甚至以自己的名义发表，我都不会追究，但你在做以上事情的时候必须保证内容的完整性，给后来的人一个完整的教程。最后，任何人不能以这些资料的任何部分，谋取任何形式的报酬。</p>
      <p>发展计划<br>
        在国外，很多资料都是很多人花费几年的时间慢慢积累起来的。如果任何人有兴趣与别人共享你的知识，我很欢迎你与我联系，但你必须同意我上面的声明。</p>
              <p>感谢<br>
                感谢我的母亲一直以来对我的支持和在生活上的照顾。<br>
                感谢我深爱的女友田芹，一直以来默默的在精神上和生活中对我的支持，她甚至把买衣服的钱都用来给我买书了，她真的是我见过的最好的女孩，希望我能带给她幸福。</p>
              <p>资源下载: <br>
                文档 <a href="javascript:if(confirm('http://www.owlei.com/DancingWind/Res/mht/NeHe%20OpenGL%20Chinese%20Course%2048.mht  \n\nThis file was not retrieved by Teleport Pro, because the server reports that this file cannot be found.  \n\nDo you want to open it from the server?'))window.location='http://www.owlei.com/DancingWind/Res/mht/NeHe%20OpenGL%20Chinese%20Course%2048.mht'" tppabs="http://www.owlei.com/DancingWind/Res/mht/NeHe%20OpenGL%20Chinese%20Course%2048.mht">网页格式</a> 
                <a href="javascript:if(confirm('http://www.owlei.com/DancingWind/Res/pdf/OpenGL_Nehe_Course_Tutorial_48.pdf  \n\nThis file was not retrieved by Teleport Pro, because the server reports that this file cannot be found.  \n\nDo you want to open it from the server?'))window.location='http://www.owlei.com/DancingWind/Res/pdf/OpenGL_Nehe_Course_Tutorial_48.pdf'" tppabs="http://www.owlei.com/DancingWind/Res/pdf/OpenGL_Nehe_Course_Tutorial_48.pdf">PDF格式</a><br>
                源码 <a href="javascript:if(confirm('http://www.owlei.com/DancingWind/Res/Src/48_ArcBall.rar  \n\nThis file was not retrieved by Teleport Pro, because the server reports that this file cannot be found.  \n\nDo you want to open it from the server?'))window.location='http://www.owlei.com/DancingWind/Res/Src/48_ArcBall.rar'" tppabs="http://www.owlei.com/DancingWind/Res/Src/48_ArcBall.rar">RAR格式</a></p></td>
  </tr>
</table>
        <FONT class=text><TABLE width="100%" border=0>
          <TBODY>
            <TR> 
              <TD align=left width="50%"><B><FONT size=-1><A 
            href="Tutorial_47.htm" tppabs="http://www.owlei.com/DancingWind/Course/Tutorial_47.htm">&lt; 第47课</A></FONT></B></TD>
              <TD align=right width="50%"></TD>
            </TR>
          </TBODY>
        </TABLE>
        </FONT> 		
    </TD>
    <TD class=r><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
  <TR>
    <TD class=bl><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=bc width="100%"><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" width=28></TD>
    <TD class=br><IMG height=28 alt="" 
      src="blank(1).gif" tppabs="http://www.owlei.com/DancingWind/Pic/blank(1).gif" 
  width=28></TD></TR></TBODY></TABLE>
</BODY></HTML>
